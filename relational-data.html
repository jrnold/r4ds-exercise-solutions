<!DOCTYPE html>
<html lang="" xml:lang="">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>13 Relational data | R for Data Science: Exercise Solutions</title>
<meta name="description" content="Solutions to the exercises in “R for Data Science” by Garrett Grolemund and Hadley Wickham.">
<meta name="generator" content="bookdown 0.20.1 and GitBook 2.6.7">
<meta property="og:title" content="13 Relational data | R for Data Science: Exercise Solutions">
<meta property="og:type" content="book">
<meta property="og:url" content="http://jrnold.github.io/r4ds-exercise-solutions">
<meta property="og:image" content="http://jrnold.github.io/r4ds-exercise-solutions/img/r4ds-exercise-solutions-cover.png">
<meta property="og:description" content="Solutions to the exercises in “R for Data Science” by Garrett Grolemund and Hadley Wickham.">
<meta name="github-repo" content="jrnold/r4ds-exercise-solutions">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="13 Relational data | R for Data Science: Exercise Solutions">
<meta name="twitter:site" content="@jrnld">
<meta name="twitter:description" content="Solutions to the exercises in “R for Data Science” by Garrett Grolemund and Hadley Wickham.">
<meta name="twitter:image" content="http://jrnold.github.io/r4ds-exercise-solutions/img/r4ds-exercise-solutions-cover.png">
<meta name="author" content="Jeffrey B. Arnold">
<meta name="date" content="2020-07-19">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<link rel="prev" href="tidy-data.html">
<link rel="next" href="strings.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script><link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet">
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet">
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet">
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet">
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet">
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet">
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet">
<script src="libs/htmlwidgets-1.5.1/htmlwidgets.js"></script><script src="libs/viz-1.8.2/viz.js"></script><link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet">
<script src="libs/grViz-binding-1.0.6.1/grViz.js"></script><link href="libs/str_view-0.1.0/str_view.css" rel="stylesheet">
<script src="libs/str_view-binding-1.4.0/str_view.js"></script><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-61453123-2"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-61453123-2');
</script><!--
License: MIT License
Copyright (c) 2016 Open Review Toolkit & Ben Marwick

See https://github.com/benmarwick/bookdown-ort/blob/master/hypothesis.html
--><script async defer src="https://hypothes.is/embed.js"></script><script>window.hypothesisConfig = function () { return {showHighlights: false}; };</script><style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; position: absolute; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; }
pre.numberSource a.sourceLine:empty
  { position: absolute; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>
<link rel="stylesheet" href="includes/r4ds.css" type="text/css">
<link rel="stylesheet" href="includes/r4ds-solutions.css" type="text/css">
<link rel="stylesheet" href="includes/ort.css" type="text/css">
</head>
<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation"><ul class="summary">
<li><strong><a href="./">R for Data Science:<br>Exercise Solutions</a></strong></li>

<li class="divider">
<li class="chapter" data-level="" data-path="index.html">
<a href="index.html"><i class="fa fa-check"></i>Welcome</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#acknowledgments"><i class="fa fa-check"></i>Acknowledgments</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#license"><i class="fa fa-check"></i>License</a></li>
</ul>
</li>
<li class="chapter" data-level="1" data-path="introduction.html">
<a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#how-this-book-is-organized"><i class="fa fa-check"></i>How this book is organized</a></li>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#prerequisites"><i class="fa fa-check"></i>Prerequisites</a></li>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#bugscontributing"><i class="fa fa-check"></i>Bugs/Contributing</a></li>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#colophon"><i class="fa fa-check"></i>Colophon</a></li>
</ul>
</li>
<li class="part"><span><b>I Explore</b></span></li>
<li class="chapter" data-level="2" data-path="explore-intro.html"><a href="explore-intro.html"><i class="fa fa-check"></i><b>2</b> Introduction</a></li>
<li class="chapter" data-level="3" data-path="data-visualisation.html">
<a href="data-visualisation.html"><i class="fa fa-check"></i><b>3</b> Data visualisation</a><ul>
<li class="chapter" data-level="3.1" data-path="data-visualisation.html"><a href="data-visualisation.html#introduction-1"><i class="fa fa-check"></i><b>3.1</b> Introduction</a></li>
<li class="chapter" data-level="3.2" data-path="data-visualisation.html">
<a href="data-visualisation.html#first-steps"><i class="fa fa-check"></i><b>3.2</b> First steps</a><ul>
<li class="chapter" data-level="" data-path="data-visualisation.html"><a href="data-visualisation.html#exercise-3.2.1"><i class="fa fa-check"></i>Exercise 3.2.1</a></li>
<li class="chapter" data-level="" data-path="data-visualisation.html"><a href="data-visualisation.html#exercise-3.2.2"><i class="fa fa-check"></i>Exercise 3.2.2</a></li>
<li class="chapter" data-level="" data-path="data-visualisation.html"><a href="data-visualisation.html#exercise-3.2.3"><i class="fa fa-check"></i>Exercise 3.2.3</a></li>
<li class="chapter" data-level="" data-path="data-visualisation.html"><a href="data-visualisation.html#exercise-3.2.4"><i class="fa fa-check"></i>Exercise 3.2.4</a></li>
<li class="chapter" data-level="" data-path="data-visualisation.html"><a href="data-visualisation.html#exercise-3.2.5"><i class="fa fa-check"></i>Exercise 3.2.5</a></li>
</ul>
</li>
<li class="chapter" data-level="3.3" data-path="data-visualisation.html">
<a href="data-visualisation.html#aesthetic-mappings"><i class="fa fa-check"></i><b>3.3</b> Aesthetic mappings</a><ul>
<li class="chapter" data-level="" data-path="data-visualisation.html"><a href="data-visualisation.html#exercise-3.3.1"><i class="fa fa-check"></i>Exercise 3.3.1</a></li>
<li class="chapter" data-level="" data-path="data-visualisation.html"><a href="data-visualisation.html#exercise-3.3.2"><i class="fa fa-check"></i>Exercise 3.3.2</a></li>
<li class="chapter" data-level="" data-path="data-visualisation.html"><a href="data-visualisation.html#exercise-3.3.3"><i class="fa fa-check"></i>Exercise 3.3.3</a></li>
<li class="chapter" data-level="" data-path="data-visualisation.html"><a href="data-visualisation.html#exercise-3.3.4"><i class="fa fa-check"></i>Exercise 3.3.4</a></li>
<li class="chapter" data-level="" data-path="data-visualisation.html"><a href="data-visualisation.html#exercise-3.3.5"><i class="fa fa-check"></i>Exercise 3.3.5</a></li>
<li class="chapter" data-level="" data-path="data-visualisation.html"><a href="data-visualisation.html#exercise-3.3.6"><i class="fa fa-check"></i>Exercise 3.3.6</a></li>
</ul>
</li>
<li class="chapter" data-level="3.4" data-path="data-visualisation.html"><a href="data-visualisation.html#common-problems"><i class="fa fa-check"></i><b>3.4</b> Common problems</a></li>
<li class="chapter" data-level="3.5" data-path="data-visualisation.html">
<a href="data-visualisation.html#facets"><i class="fa fa-check"></i><b>3.5</b> Facets</a><ul>
<li class="chapter" data-level="" data-path="data-visualisation.html"><a href="data-visualisation.html#exercise-3.5.1"><i class="fa fa-check"></i>Exercise 3.5.1</a></li>
<li class="chapter" data-level="" data-path="data-visualisation.html"><a href="data-visualisation.html#exercise-3.5.2"><i class="fa fa-check"></i>Exercise 3.5.2</a></li>
<li class="chapter" data-level="" data-path="data-visualisation.html"><a href="data-visualisation.html#exercise-3.5.3"><i class="fa fa-check"></i>Exercise 3.5.3</a></li>
<li class="chapter" data-level="" data-path="data-visualisation.html"><a href="data-visualisation.html#exercise-3.5.4"><i class="fa fa-check"></i>Exercise 3.5.4</a></li>
<li class="chapter" data-level="" data-path="data-visualisation.html"><a href="data-visualisation.html#exercise-3.5.5"><i class="fa fa-check"></i>Exercise 3.5.5</a></li>
<li class="chapter" data-level="" data-path="data-visualisation.html"><a href="data-visualisation.html#exercise-3.5.6"><i class="fa fa-check"></i>Exercise 3.5.6</a></li>
</ul>
</li>
<li class="chapter" data-level="3.6" data-path="data-visualisation.html">
<a href="data-visualisation.html#geometric-objects"><i class="fa fa-check"></i><b>3.6</b> Geometric objects</a><ul>
<li class="chapter" data-level="" data-path="data-visualisation.html"><a href="data-visualisation.html#exercise-3.6.1"><i class="fa fa-check"></i>Exercise 3.6.1</a></li>
<li class="chapter" data-level="" data-path="data-visualisation.html"><a href="data-visualisation.html#exercise-3.6.2"><i class="fa fa-check"></i>Exercise 3.6.2</a></li>
<li class="chapter" data-level="" data-path="data-visualisation.html"><a href="data-visualisation.html#exercise-3.6.3"><i class="fa fa-check"></i>Exercise 3.6.3</a></li>
<li class="chapter" data-level="" data-path="data-visualisation.html"><a href="data-visualisation.html#exercise-3.6.4"><i class="fa fa-check"></i>Exercise 3.6.4</a></li>
<li class="chapter" data-level="" data-path="data-visualisation.html"><a href="data-visualisation.html#exercise-3.6.5"><i class="fa fa-check"></i>Exercise 3.6.5</a></li>
<li class="chapter" data-level="" data-path="data-visualisation.html"><a href="data-visualisation.html#exercise-3.6.6"><i class="fa fa-check"></i>Exercise 3.6.6</a></li>
</ul>
</li>
<li class="chapter" data-level="3.7" data-path="data-visualisation.html">
<a href="data-visualisation.html#statistical-transformations"><i class="fa fa-check"></i><b>3.7</b> Statistical transformations</a><ul>
<li class="chapter" data-level="" data-path="data-visualisation.html"><a href="data-visualisation.html#exercise-3.7.1"><i class="fa fa-check"></i>Exercise 3.7.1</a></li>
<li class="chapter" data-level="" data-path="data-visualisation.html"><a href="data-visualisation.html#exercise-3.7.2"><i class="fa fa-check"></i>Exercise 3.7.2</a></li>
<li class="chapter" data-level="" data-path="data-visualisation.html"><a href="data-visualisation.html#exercise-3.7.3"><i class="fa fa-check"></i>Exercise 3.7.3</a></li>
<li class="chapter" data-level="" data-path="data-visualisation.html"><a href="data-visualisation.html#exercise-3.7.4"><i class="fa fa-check"></i>Exercise 3.7.4</a></li>
<li class="chapter" data-level="" data-path="data-visualisation.html"><a href="data-visualisation.html#exercise-3.7.5"><i class="fa fa-check"></i>Exercise 3.7.5</a></li>
</ul>
</li>
<li class="chapter" data-level="3.8" data-path="data-visualisation.html">
<a href="data-visualisation.html#position-adjustments"><i class="fa fa-check"></i><b>3.8</b> Position adjustments</a><ul>
<li class="chapter" data-level="" data-path="data-visualisation.html"><a href="data-visualisation.html#exercise-3.8.1"><i class="fa fa-check"></i>Exercise 3.8.1</a></li>
<li class="chapter" data-level="" data-path="data-visualisation.html"><a href="data-visualisation.html#exercise-3.8.2"><i class="fa fa-check"></i>Exercise 3.8.2</a></li>
<li class="chapter" data-level="" data-path="data-visualisation.html"><a href="data-visualisation.html#exercise-3.8.3"><i class="fa fa-check"></i>Exercise 3.8.3</a></li>
<li class="chapter" data-level="" data-path="data-visualisation.html"><a href="data-visualisation.html#exercise-3.8.4"><i class="fa fa-check"></i>Exercise 3.8.4</a></li>
</ul>
</li>
<li class="chapter" data-level="3.9" data-path="data-visualisation.html">
<a href="data-visualisation.html#coordinate-systems"><i class="fa fa-check"></i><b>3.9</b> Coordinate systems</a><ul>
<li class="chapter" data-level="" data-path="data-visualisation.html"><a href="data-visualisation.html#exercise-3.9.1"><i class="fa fa-check"></i>Exercise 3.9.1</a></li>
<li class="chapter" data-level="" data-path="data-visualisation.html"><a href="data-visualisation.html#exercise-3.9.2"><i class="fa fa-check"></i>Exercise 3.9.2</a></li>
<li class="chapter" data-level="" data-path="data-visualisation.html"><a href="data-visualisation.html#exercise-3.9.3"><i class="fa fa-check"></i>Exercise 3.9.3</a></li>
<li class="chapter" data-level="" data-path="data-visualisation.html"><a href="data-visualisation.html#exercise-3.9.4"><i class="fa fa-check"></i>Exercise 3.9.4</a></li>
</ul>
</li>
<li class="chapter" data-level="3.10" data-path="data-visualisation.html"><a href="data-visualisation.html#the-layered-grammar-of-graphics"><i class="fa fa-check"></i><b>3.10</b> The layered grammar of graphics</a></li>
</ul>
</li>
<li class="chapter" data-level="4" data-path="workflow-basics.html">
<a href="workflow-basics.html"><i class="fa fa-check"></i><b>4</b> Workflow: basics</a><ul>
<li class="chapter" data-level="" data-path="workflow-basics.html"><a href="workflow-basics.html#exercise-4.1"><i class="fa fa-check"></i>Exercise 4.1</a></li>
<li class="chapter" data-level="" data-path="workflow-basics.html"><a href="workflow-basics.html#exercise-4.2"><i class="fa fa-check"></i>Exercise 4.2</a></li>
<li class="chapter" data-level="" data-path="workflow-basics.html"><a href="workflow-basics.html#exercise-4.3"><i class="fa fa-check"></i>Exercise 4.3</a></li>
</ul>
</li>
<li class="chapter" data-level="5" data-path="transform.html">
<a href="transform.html"><i class="fa fa-check"></i><b>5</b> Data transformation</a><ul>
<li class="chapter" data-level="5.1" data-path="transform.html"><a href="transform.html#introduction-2"><i class="fa fa-check"></i><b>5.1</b> Introduction</a></li>
<li class="chapter" data-level="5.2" data-path="transform.html">
<a href="transform.html#filter-rows-with-filter"><i class="fa fa-check"></i><b>5.2</b> Filter rows with <code>filter()</code></a><ul>
<li class="chapter" data-level="" data-path="transform.html"><a href="transform.html#exercise-5.2.1"><i class="fa fa-check"></i>Exercise 5.2.1</a></li>
<li class="chapter" data-level="" data-path="transform.html"><a href="transform.html#exercise-5.2.2"><i class="fa fa-check"></i>Exercise 5.2.2</a></li>
<li class="chapter" data-level="" data-path="transform.html"><a href="transform.html#exercise-5.2.3"><i class="fa fa-check"></i>Exercise 5.2.3</a></li>
<li class="chapter" data-level="" data-path="transform.html"><a href="transform.html#exercise-5.2.4"><i class="fa fa-check"></i>Exercise 5.2.4</a></li>
</ul>
</li>
<li class="chapter" data-level="5.3" data-path="transform.html">
<a href="transform.html#arrange-rows-with-arrange"><i class="fa fa-check"></i><b>5.3</b> Arrange rows with <code>arrange()</code></a><ul>
<li class="chapter" data-level="" data-path="transform.html"><a href="transform.html#exercise-5.3.1"><i class="fa fa-check"></i>Exercise 5.3.1</a></li>
<li class="chapter" data-level="" data-path="transform.html"><a href="transform.html#exercise-5.3.2"><i class="fa fa-check"></i>Exercise 5.3.2</a></li>
<li class="chapter" data-level="" data-path="transform.html"><a href="transform.html#exercise-5.3.3"><i class="fa fa-check"></i>Exercise 5.3.3</a></li>
<li class="chapter" data-level="" data-path="transform.html"><a href="transform.html#exercise-5.3.4"><i class="fa fa-check"></i>Exercise 5.3.4</a></li>
</ul>
</li>
<li class="chapter" data-level="5.4" data-path="transform.html">
<a href="transform.html#select"><i class="fa fa-check"></i><b>5.4</b> Select columns with <code>select()</code></a><ul>
<li class="chapter" data-level="" data-path="transform.html"><a href="transform.html#exercise-5.4.1"><i class="fa fa-check"></i>Exercise 5.4.1</a></li>
<li class="chapter" data-level="" data-path="transform.html"><a href="transform.html#exercise-5.4.2"><i class="fa fa-check"></i>Exercise 5.4.2</a></li>
<li class="chapter" data-level="" data-path="transform.html"><a href="transform.html#exercise-5.4.3"><i class="fa fa-check"></i>Exercise 5.4.3</a></li>
<li class="chapter" data-level="" data-path="transform.html"><a href="transform.html#exercise-5.4.4"><i class="fa fa-check"></i>Exercise 5.4.4</a></li>
</ul>
</li>
<li class="chapter" data-level="5.5" data-path="transform.html">
<a href="transform.html#add-new-variables-with-mutate"><i class="fa fa-check"></i><b>5.5</b> Add new variables with <code>mutate()</code></a><ul>
<li class="chapter" data-level="" data-path="transform.html"><a href="transform.html#exercise-5.5.1"><i class="fa fa-check"></i>Exercise 5.5.1</a></li>
<li class="chapter" data-level="" data-path="transform.html"><a href="transform.html#exercise-5.5.2"><i class="fa fa-check"></i>Exercise 5.5.2</a></li>
<li class="chapter" data-level="" data-path="transform.html"><a href="transform.html#exercise-5.5.3"><i class="fa fa-check"></i>Exercise 5.5.3</a></li>
<li class="chapter" data-level="" data-path="transform.html"><a href="transform.html#exercise-5.5.4"><i class="fa fa-check"></i>Exercise 5.5.4</a></li>
<li class="chapter" data-level="" data-path="transform.html"><a href="transform.html#exercise-5.5.5"><i class="fa fa-check"></i>Exercise 5.5.5</a></li>
<li class="chapter" data-level="" data-path="transform.html"><a href="transform.html#exercise-5.5.6"><i class="fa fa-check"></i>Exercise 5.5.6</a></li>
</ul>
</li>
<li class="chapter" data-level="5.6" data-path="transform.html">
<a href="transform.html#grouped-summaries-with-summarise"><i class="fa fa-check"></i><b>5.6</b> Grouped summaries with <code>summarise()</code></a><ul>
<li class="chapter" data-level="" data-path="transform.html"><a href="transform.html#exercise-5.6.1"><i class="fa fa-check"></i>Exercise 5.6.1</a></li>
<li class="chapter" data-level="" data-path="transform.html"><a href="transform.html#exercise-5.6.2"><i class="fa fa-check"></i>Exercise 5.6.2</a></li>
<li class="chapter" data-level="" data-path="transform.html"><a href="transform.html#exercise-5.6.3"><i class="fa fa-check"></i>Exercise 5.6.3</a></li>
<li class="chapter" data-level="" data-path="transform.html"><a href="transform.html#exercise-5.6.4"><i class="fa fa-check"></i>Exercise 5.6.4</a></li>
<li class="chapter" data-level="" data-path="transform.html"><a href="transform.html#exercise-5.6.5"><i class="fa fa-check"></i>Exercise 5.6.5</a></li>
<li class="chapter" data-level="" data-path="transform.html"><a href="transform.html#exercise-5.6.6"><i class="fa fa-check"></i>Exercise 5.6.6</a></li>
</ul>
</li>
<li class="chapter" data-level="5.7" data-path="transform.html">
<a href="transform.html#grouped-mutates-and-filters"><i class="fa fa-check"></i><b>5.7</b> Grouped mutates (and filters)</a><ul>
<li class="chapter" data-level="" data-path="transform.html"><a href="transform.html#exercise-5.7.1"><i class="fa fa-check"></i>Exercise 5.7.1</a></li>
<li class="chapter" data-level="" data-path="transform.html"><a href="transform.html#exercise-5.7.2"><i class="fa fa-check"></i>Exercise 5.7.2</a></li>
<li class="chapter" data-level="" data-path="transform.html"><a href="transform.html#exercise-5.7.3"><i class="fa fa-check"></i>Exercise 5.7.3</a></li>
<li class="chapter" data-level="" data-path="transform.html"><a href="transform.html#exercise-5.7.4"><i class="fa fa-check"></i>Exercise 5.7.4</a></li>
<li class="chapter" data-level="" data-path="transform.html"><a href="transform.html#exercise-5.7.5"><i class="fa fa-check"></i>Exercise 5.7.5</a></li>
<li class="chapter" data-level="" data-path="transform.html"><a href="transform.html#exercise-5.7.6"><i class="fa fa-check"></i>Exercise 5.7.6</a></li>
<li class="chapter" data-level="" data-path="transform.html"><a href="transform.html#exercise-5.7.7"><i class="fa fa-check"></i>Exercise 5.7.7</a></li>
<li class="chapter" data-level="" data-path="transform.html"><a href="transform.html#exercise-5.7.8"><i class="fa fa-check"></i>Exercise 5.7.8</a></li>
</ul>
</li>
</ul>
</li>
<li class="chapter" data-level="6" data-path="workflow-scripts.html">
<a href="workflow-scripts.html"><i class="fa fa-check"></i><b>6</b> Workflow: scripts</a><ul>
<li class="chapter" data-level="" data-path="workflow-scripts.html"><a href="workflow-scripts.html#exercise-6.1"><i class="fa fa-check"></i>Exercise 6.1</a></li>
<li class="chapter" data-level="" data-path="workflow-scripts.html"><a href="workflow-scripts.html#exercise-6.2"><i class="fa fa-check"></i>Exercise 6.2</a></li>
</ul>
</li>
<li class="chapter" data-level="7" data-path="exploratory-data-analysis.html">
<a href="exploratory-data-analysis.html"><i class="fa fa-check"></i><b>7</b> Exploratory Data Analysis</a><ul>
<li class="chapter" data-level="7.1" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#introduction-3"><i class="fa fa-check"></i><b>7.1</b> Introduction</a></li>
<li class="chapter" data-level="7.2" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#questions"><i class="fa fa-check"></i><b>7.2</b> Questions</a></li>
<li class="chapter" data-level="7.3" data-path="exploratory-data-analysis.html">
<a href="exploratory-data-analysis.html#variation"><i class="fa fa-check"></i><b>7.3</b> Variation</a><ul>
<li class="chapter" data-level="" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#exercise-7.3.1"><i class="fa fa-check"></i>Exercise 7.3.1</a></li>
<li class="chapter" data-level="" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#exercise-7.3.2"><i class="fa fa-check"></i>Exercise 7.3.2</a></li>
<li class="chapter" data-level="" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#exercise-7.3.3"><i class="fa fa-check"></i>Exercise 7.3.3</a></li>
<li class="chapter" data-level="" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#exercise-7.3.4"><i class="fa fa-check"></i>Exercise 7.3.4</a></li>
</ul>
</li>
<li class="chapter" data-level="7.4" data-path="exploratory-data-analysis.html">
<a href="exploratory-data-analysis.html#missing-values-2"><i class="fa fa-check"></i><b>7.4</b> Missing values</a><ul>
<li class="chapter" data-level="" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#exercise-7.4.1"><i class="fa fa-check"></i>Exercise 7.4.1</a></li>
<li class="chapter" data-level="" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#exercise-7.4.2"><i class="fa fa-check"></i>Exercise 7.4.2</a></li>
</ul>
</li>
<li class="chapter" data-level="7.5" data-path="exploratory-data-analysis.html">
<a href="exploratory-data-analysis.html#covariation"><i class="fa fa-check"></i><b>7.5</b> Covariation</a><ul>
<li class="chapter" data-level="7.5.1" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#a-categorical-and-continuous-variable"><i class="fa fa-check"></i><b>7.5.1</b> A categorical and continuous variable</a></li>
<li class="chapter" data-level="7.5.2" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#two-categorical-variables"><i class="fa fa-check"></i><b>7.5.2</b> Two categorical variables</a></li>
<li class="chapter" data-level="7.5.3" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#two-continuous-variables"><i class="fa fa-check"></i><b>7.5.3</b> Two continuous variables</a></li>
</ul>
</li>
<li class="chapter" data-level="7.6" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#patterns-and-models"><i class="fa fa-check"></i><b>7.6</b> Patterns and models</a></li>
<li class="chapter" data-level="7.7" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#ggplot2-calls"><i class="fa fa-check"></i><b>7.7</b> ggplot2 calls</a></li>
<li class="chapter" data-level="7.8" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#learning-more"><i class="fa fa-check"></i><b>7.8</b> Learning more</a></li>
</ul>
</li>
<li class="chapter" data-level="8" data-path="workflow-projects.html"><a href="workflow-projects.html"><i class="fa fa-check"></i><b>8</b> Workflow: projects</a></li>
<li class="part"><span><b>II Wrangle</b></span></li>
<li class="chapter" data-level="9" data-path="wrangle-intro.html"><a href="wrangle-intro.html"><i class="fa fa-check"></i><b>9</b> Introduction</a></li>
<li class="chapter" data-level="10" data-path="tibbles.html">
<a href="tibbles.html"><i class="fa fa-check"></i><b>10</b> Tibbles</a><ul>
<li class="chapter" data-level="" data-path="tibbles.html"><a href="tibbles.html#exercise-10.1"><i class="fa fa-check"></i>Exercise 10.1</a></li>
<li class="chapter" data-level="" data-path="tibbles.html"><a href="tibbles.html#exercise-10.2"><i class="fa fa-check"></i>Exercise 10.2</a></li>
<li class="chapter" data-level="" data-path="tibbles.html"><a href="tibbles.html#exercise-10.3"><i class="fa fa-check"></i>Exercise 10.3</a></li>
<li class="chapter" data-level="" data-path="tibbles.html"><a href="tibbles.html#exercise-10.4"><i class="fa fa-check"></i>Exercise 10.4</a></li>
<li class="chapter" data-level="" data-path="tibbles.html"><a href="tibbles.html#exercise-10.5"><i class="fa fa-check"></i>Exercise 10.5</a></li>
<li class="chapter" data-level="" data-path="tibbles.html"><a href="tibbles.html#exercise-10.6"><i class="fa fa-check"></i>Exercise 10.6</a></li>
</ul>
</li>
<li class="chapter" data-level="11" data-path="data-import.html">
<a href="data-import.html"><i class="fa fa-check"></i><b>11</b> Data import</a><ul>
<li class="chapter" data-level="11.1" data-path="data-import.html"><a href="data-import.html#introduction-5"><i class="fa fa-check"></i><b>11.1</b> Introduction</a></li>
<li class="chapter" data-level="11.2" data-path="data-import.html">
<a href="data-import.html#getting-started"><i class="fa fa-check"></i><b>11.2</b> Getting started</a><ul>
<li class="chapter" data-level="" data-path="data-import.html"><a href="data-import.html#exercise-11.2.1"><i class="fa fa-check"></i>Exercise 11.2.1</a></li>
<li class="chapter" data-level="" data-path="data-import.html"><a href="data-import.html#exercise-11.2.2"><i class="fa fa-check"></i>Exercise 11.2.2</a></li>
<li class="chapter" data-level="" data-path="data-import.html"><a href="data-import.html#exercise-11.2.3"><i class="fa fa-check"></i>Exercise 11.2.3</a></li>
<li class="chapter" data-level="" data-path="data-import.html"><a href="data-import.html#exercise-11.2.4"><i class="fa fa-check"></i>Exercise 11.2.4</a></li>
<li class="chapter" data-level="" data-path="data-import.html"><a href="data-import.html#exercise-11.2.5"><i class="fa fa-check"></i>Exercise 11.2.5</a></li>
</ul>
</li>
<li class="chapter" data-level="11.3" data-path="data-import.html">
<a href="data-import.html#parsing-a-vector"><i class="fa fa-check"></i><b>11.3</b> Parsing a vector</a><ul>
<li class="chapter" data-level="" data-path="data-import.html"><a href="data-import.html#exercise-11.3.1"><i class="fa fa-check"></i>Exercise 11.3.1</a></li>
<li class="chapter" data-level="" data-path="data-import.html"><a href="data-import.html#exercise-11.3.2"><i class="fa fa-check"></i>Exercise 11.3.2</a></li>
<li class="chapter" data-level="" data-path="data-import.html"><a href="data-import.html#exercise-11.3.3"><i class="fa fa-check"></i>Exercise 11.3.3</a></li>
<li class="chapter" data-level="" data-path="data-import.html"><a href="data-import.html#exercise-11.3.4"><i class="fa fa-check"></i>Exercise 11.3.4</a></li>
<li class="chapter" data-level="" data-path="data-import.html"><a href="data-import.html#exercise-11.3.5"><i class="fa fa-check"></i>Exercise 11.3.5</a></li>
<li class="chapter" data-level="" data-path="data-import.html"><a href="data-import.html#exercise-11.3.6"><i class="fa fa-check"></i>Exercise 11.3.6</a></li>
<li class="chapter" data-level="" data-path="data-import.html"><a href="data-import.html#exercise-11.3.7"><i class="fa fa-check"></i>Exercise 11.3.7</a></li>
</ul>
</li>
<li class="chapter" data-level="11.4" data-path="data-import.html"><a href="data-import.html#parsing-a-file"><i class="fa fa-check"></i><b>11.4</b> Parsing a file</a></li>
<li class="chapter" data-level="11.5" data-path="data-import.html"><a href="data-import.html#writing-to-a-file"><i class="fa fa-check"></i><b>11.5</b> Writing to a file</a></li>
<li class="chapter" data-level="11.6" data-path="data-import.html"><a href="data-import.html#other-types-of-data"><i class="fa fa-check"></i><b>11.6</b> Other types of data</a></li>
</ul>
</li>
<li class="chapter" data-level="12" data-path="tidy-data.html">
<a href="tidy-data.html"><i class="fa fa-check"></i><b>12</b> Tidy data</a><ul>
<li class="chapter" data-level="12.1" data-path="tidy-data.html"><a href="tidy-data.html#introduction-6"><i class="fa fa-check"></i><b>12.1</b> Introduction</a></li>
<li class="chapter" data-level="12.2" data-path="tidy-data.html">
<a href="tidy-data.html#tidy-data-1"><i class="fa fa-check"></i><b>12.2</b> Tidy data</a><ul>
<li class="chapter" data-level="" data-path="tidy-data.html"><a href="tidy-data.html#exercise-12.2.1"><i class="fa fa-check"></i>Exercise 12.2.1</a></li>
<li class="chapter" data-level="" data-path="tidy-data.html"><a href="tidy-data.html#exercise-12.2.2"><i class="fa fa-check"></i>Exercise 12.2.2</a></li>
<li class="chapter" data-level="" data-path="tidy-data.html"><a href="tidy-data.html#exercise-12.2.3"><i class="fa fa-check"></i>Exercise 12.2.3</a></li>
</ul>
</li>
<li class="chapter" data-level="12.3" data-path="tidy-data.html">
<a href="tidy-data.html#pivoting"><i class="fa fa-check"></i><b>12.3</b> Pivoting</a><ul>
<li class="chapter" data-level="" data-path="tidy-data.html"><a href="tidy-data.html#exercise-12.3.1"><i class="fa fa-check"></i>Exercise 12.3.1</a></li>
<li class="chapter" data-level="" data-path="tidy-data.html"><a href="tidy-data.html#exercise-12.3.2"><i class="fa fa-check"></i>Exercise 12.3.2</a></li>
<li class="chapter" data-level="" data-path="tidy-data.html"><a href="tidy-data.html#exercise-12.3.3"><i class="fa fa-check"></i>Exercise 12.3.3</a></li>
<li class="chapter" data-level="" data-path="tidy-data.html"><a href="tidy-data.html#exercise-12.3.4"><i class="fa fa-check"></i>Exercise 12.3.4</a></li>
</ul>
</li>
<li class="chapter" data-level="12.4" data-path="tidy-data.html">
<a href="tidy-data.html#separating-and-uniting"><i class="fa fa-check"></i><b>12.4</b> Separating and uniting</a><ul>
<li class="chapter" data-level="" data-path="tidy-data.html"><a href="tidy-data.html#exercise-12.4.1"><i class="fa fa-check"></i>Exercise 12.4.1</a></li>
<li class="chapter" data-level="" data-path="tidy-data.html"><a href="tidy-data.html#exercise-12.4.2"><i class="fa fa-check"></i>Exercise 12.4.2</a></li>
<li class="chapter" data-level="" data-path="tidy-data.html"><a href="tidy-data.html#exercise-12.4.3"><i class="fa fa-check"></i>Exercise 12.4.3</a></li>
</ul>
</li>
<li class="chapter" data-level="12.5" data-path="tidy-data.html">
<a href="tidy-data.html#missing-values-3"><i class="fa fa-check"></i><b>12.5</b> Missing values</a><ul>
<li class="chapter" data-level="" data-path="tidy-data.html"><a href="tidy-data.html#exercise-12.5.1"><i class="fa fa-check"></i>Exercise 12.5.1</a></li>
<li class="chapter" data-level="" data-path="tidy-data.html"><a href="tidy-data.html#exercise-12.5.2"><i class="fa fa-check"></i>Exercise 12.5.2</a></li>
</ul>
</li>
<li class="chapter" data-level="12.6" data-path="tidy-data.html">
<a href="tidy-data.html#case-study"><i class="fa fa-check"></i><b>12.6</b> Case Study</a><ul>
<li class="chapter" data-level="" data-path="tidy-data.html"><a href="tidy-data.html#exercise-12.6.1"><i class="fa fa-check"></i>Exercise 12.6.1</a></li>
<li class="chapter" data-level="" data-path="tidy-data.html"><a href="tidy-data.html#exercise-12.6.2"><i class="fa fa-check"></i>Exercise 12.6.2</a></li>
<li class="chapter" data-level="" data-path="tidy-data.html"><a href="tidy-data.html#exercise-12.6.3"><i class="fa fa-check"></i>Exercise 12.6.3</a></li>
<li class="chapter" data-level="" data-path="tidy-data.html"><a href="tidy-data.html#exercise-12.6.4"><i class="fa fa-check"></i>Exercise 12.6.4</a></li>
</ul>
</li>
<li class="chapter" data-level="12.7" data-path="tidy-data.html"><a href="tidy-data.html#non-tidy-data"><i class="fa fa-check"></i><b>12.7</b> Non-tidy data</a></li>
</ul>
</li>
<li class="chapter" data-level="13" data-path="relational-data.html">
<a href="relational-data.html"><i class="fa fa-check"></i><b>13</b> Relational data</a><ul>
<li class="chapter" data-level="13.1" data-path="relational-data.html"><a href="relational-data.html#introduction-7"><i class="fa fa-check"></i><b>13.1</b> Introduction</a></li>
<li class="chapter" data-level="13.2" data-path="relational-data.html">
<a href="relational-data.html#nycflights13-relational"><i class="fa fa-check"></i><b>13.2</b> nycflights13</a><ul>
<li class="chapter" data-level="" data-path="relational-data.html"><a href="relational-data.html#exercise-13.2.1"><i class="fa fa-check"></i>Exercise 13.2.1</a></li>
<li class="chapter" data-level="" data-path="relational-data.html"><a href="relational-data.html#exercise-13.2.2"><i class="fa fa-check"></i>Exercise 13.2.2</a></li>
<li class="chapter" data-level="" data-path="relational-data.html"><a href="relational-data.html#exercise-13.2.3"><i class="fa fa-check"></i>Exercise 13.2.3</a></li>
<li class="chapter" data-level="" data-path="relational-data.html"><a href="relational-data.html#exercise-13.2.4"><i class="fa fa-check"></i>Exercise 13.2.4</a></li>
</ul>
</li>
<li class="chapter" data-level="13.3" data-path="relational-data.html">
<a href="relational-data.html#keys"><i class="fa fa-check"></i><b>13.3</b> Keys</a><ul>
<li class="chapter" data-level="" data-path="relational-data.html"><a href="relational-data.html#exercise-13.3.1"><i class="fa fa-check"></i>Exercise 13.3.1</a></li>
<li class="chapter" data-level="" data-path="relational-data.html"><a href="relational-data.html#exercise-13.3.2"><i class="fa fa-check"></i>Exercise 13.3.2</a></li>
<li class="chapter" data-level="" data-path="relational-data.html"><a href="relational-data.html#exercise-13.3.3"><i class="fa fa-check"></i>Exercise 13.3.3</a></li>
</ul>
</li>
<li class="chapter" data-level="13.4" data-path="relational-data.html">
<a href="relational-data.html#mutating-joins"><i class="fa fa-check"></i><b>13.4</b> Mutating joins</a><ul>
<li class="chapter" data-level="" data-path="relational-data.html"><a href="relational-data.html#exercise-13.4.1"><i class="fa fa-check"></i>Exercise 13.4.1</a></li>
<li class="chapter" data-level="" data-path="relational-data.html"><a href="relational-data.html#exercise-13.4.2"><i class="fa fa-check"></i>Exercise 13.4.2</a></li>
<li class="chapter" data-level="" data-path="relational-data.html"><a href="relational-data.html#exercise-13.4.3"><i class="fa fa-check"></i>Exercise 13.4.3</a></li>
<li class="chapter" data-level="" data-path="relational-data.html"><a href="relational-data.html#exercise-13.4.4"><i class="fa fa-check"></i>Exercise 13.4.4</a></li>
<li class="chapter" data-level="" data-path="relational-data.html"><a href="relational-data.html#exercise-13.4.5"><i class="fa fa-check"></i>Exercise 13.4.5</a></li>
</ul>
</li>
<li class="chapter" data-level="13.5" data-path="relational-data.html">
<a href="relational-data.html#filtering-joins"><i class="fa fa-check"></i><b>13.5</b> Filtering joins</a><ul>
<li class="chapter" data-level="" data-path="relational-data.html"><a href="relational-data.html#exercise-13.5.1"><i class="fa fa-check"></i>Exercise 13.5.1</a></li>
<li class="chapter" data-level="" data-path="relational-data.html"><a href="relational-data.html#exercise-13.5.2"><i class="fa fa-check"></i>Exercise 13.5.2</a></li>
<li class="chapter" data-level="" data-path="relational-data.html"><a href="relational-data.html#exercise-13.5.3"><i class="fa fa-check"></i>Exercise 13.5.3</a></li>
<li class="chapter" data-level="" data-path="relational-data.html"><a href="relational-data.html#exercise-13.5.4"><i class="fa fa-check"></i>Exercise 13.5.4</a></li>
<li class="chapter" data-level="" data-path="relational-data.html"><a href="relational-data.html#exercise-13.5.5"><i class="fa fa-check"></i>Exercise 13.5.5</a></li>
<li class="chapter" data-level="" data-path="relational-data.html"><a href="relational-data.html#exercise-13.5.6"><i class="fa fa-check"></i>Exercise 13.5.6</a></li>
</ul>
</li>
<li class="chapter" data-level="13.6" data-path="relational-data.html"><a href="relational-data.html#join-problems"><i class="fa fa-check"></i><b>13.6</b> Join problems</a></li>
<li class="chapter" data-level="13.7" data-path="relational-data.html"><a href="relational-data.html#set-operations"><i class="fa fa-check"></i><b>13.7</b> Set operations</a></li>
</ul>
</li>
<li class="chapter" data-level="14" data-path="strings.html">
<a href="strings.html"><i class="fa fa-check"></i><b>14</b> Strings</a><ul>
<li class="chapter" data-level="14.1" data-path="strings.html"><a href="strings.html#introduction-8"><i class="fa fa-check"></i><b>14.1</b> Introduction</a></li>
<li class="chapter" data-level="14.2" data-path="strings.html">
<a href="strings.html#string-basics"><i class="fa fa-check"></i><b>14.2</b> String basics</a><ul>
<li class="chapter" data-level="" data-path="strings.html"><a href="strings.html#exercise-14.2.1"><i class="fa fa-check"></i>Exercise 14.2.1</a></li>
<li class="chapter" data-level="" data-path="strings.html"><a href="strings.html#exercise-14.2.2"><i class="fa fa-check"></i>Exercise 14.2.2</a></li>
<li class="chapter" data-level="" data-path="strings.html"><a href="strings.html#exercise-14.2.3"><i class="fa fa-check"></i>Exercise 14.2.3</a></li>
<li class="chapter" data-level="" data-path="strings.html"><a href="strings.html#exercise-14.2.4"><i class="fa fa-check"></i>Exercise 14.2.4</a></li>
<li class="chapter" data-level="" data-path="strings.html"><a href="strings.html#exercise-14.2.5"><i class="fa fa-check"></i>Exercise 14.2.5</a></li>
<li class="chapter" data-level="" data-path="strings.html"><a href="strings.html#exercise-14.2.6"><i class="fa fa-check"></i>Exercise 14.2.6</a></li>
</ul>
</li>
<li class="chapter" data-level="14.3" data-path="strings.html">
<a href="strings.html#matching-patterns-with-regular-expressions"><i class="fa fa-check"></i><b>14.3</b> Matching patterns with regular expressions</a><ul>
<li class="chapter" data-level="14.3.1" data-path="strings.html"><a href="strings.html#basic-matches"><i class="fa fa-check"></i><b>14.3.1</b> Basic matches</a></li>
<li class="chapter" data-level="14.3.2" data-path="strings.html"><a href="strings.html#anchors"><i class="fa fa-check"></i><b>14.3.2</b> Anchors</a></li>
<li class="chapter" data-level="14.3.3" data-path="strings.html"><a href="strings.html#character-classes-and-alternatives"><i class="fa fa-check"></i><b>14.3.3</b> Character classes and alternatives</a></li>
<li class="chapter" data-level="14.3.4" data-path="strings.html"><a href="strings.html#repetition"><i class="fa fa-check"></i><b>14.3.4</b> Repetition</a></li>
<li class="chapter" data-level="14.3.5" data-path="strings.html"><a href="strings.html#grouping-and-backreferences"><i class="fa fa-check"></i><b>14.3.5</b> Grouping and backreferences</a></li>
</ul>
</li>
<li class="chapter" data-level="14.4" data-path="strings.html">
<a href="strings.html#tools"><i class="fa fa-check"></i><b>14.4</b> Tools</a><ul>
<li class="chapter" data-level="14.4.1" data-path="strings.html"><a href="strings.html#detect-matches"><i class="fa fa-check"></i><b>14.4.1</b> Detect matches</a></li>
<li class="chapter" data-level="14.4.2" data-path="strings.html"><a href="strings.html#extract-matches"><i class="fa fa-check"></i><b>14.4.2</b> Extract matches</a></li>
<li class="chapter" data-level="14.4.3" data-path="strings.html"><a href="strings.html#grouped-matches"><i class="fa fa-check"></i><b>14.4.3</b> Grouped matches</a></li>
<li class="chapter" data-level="14.4.4" data-path="strings.html"><a href="strings.html#replacing-matches"><i class="fa fa-check"></i><b>14.4.4</b> Replacing matches</a></li>
<li class="chapter" data-level="14.4.5" data-path="strings.html"><a href="strings.html#splitting"><i class="fa fa-check"></i><b>14.4.5</b> Splitting</a></li>
<li class="chapter" data-level="14.4.6" data-path="strings.html"><a href="strings.html#find-matches"><i class="fa fa-check"></i><b>14.4.6</b> Find matches</a></li>
</ul>
</li>
<li class="chapter" data-level="14.5" data-path="strings.html">
<a href="strings.html#other-types-of-pattern"><i class="fa fa-check"></i><b>14.5</b> Other types of pattern</a><ul>
<li class="chapter" data-level="" data-path="strings.html"><a href="strings.html#exercise-14.5.1"><i class="fa fa-check"></i>Exercise 14.5.1</a></li>
<li class="chapter" data-level="" data-path="strings.html"><a href="strings.html#exercise-14.5.2"><i class="fa fa-check"></i>Exercise 14.5.2</a></li>
</ul>
</li>
<li class="chapter" data-level="14.6" data-path="strings.html"><a href="strings.html#other-uses-of-regular-expressions"><i class="fa fa-check"></i><b>14.6</b> Other uses of regular expressions</a></li>
<li class="chapter" data-level="14.7" data-path="strings.html">
<a href="strings.html#stringi"><i class="fa fa-check"></i><b>14.7</b> stringi</a><ul>
<li class="chapter" data-level="" data-path="strings.html"><a href="strings.html#exercise-14.7.1"><i class="fa fa-check"></i>Exercise 14.7.1</a></li>
<li class="chapter" data-level="" data-path="strings.html"><a href="strings.html#exercise-14.7.2"><i class="fa fa-check"></i>Exercise 14.7.2</a></li>
</ul>
</li>
</ul>
</li>
<li class="chapter" data-level="15" data-path="factors.html">
<a href="factors.html"><i class="fa fa-check"></i><b>15</b> Factors</a><ul>
<li class="chapter" data-level="15.1" data-path="factors.html"><a href="factors.html#introduction-9"><i class="fa fa-check"></i><b>15.1</b> Introduction</a></li>
<li class="chapter" data-level="15.2" data-path="factors.html"><a href="factors.html#creating-factors"><i class="fa fa-check"></i><b>15.2</b> Creating factors</a></li>
<li class="chapter" data-level="15.3" data-path="factors.html">
<a href="factors.html#general-social-survey"><i class="fa fa-check"></i><b>15.3</b> General Social Survey</a><ul>
<li class="chapter" data-level="" data-path="factors.html"><a href="factors.html#exercise-15.3.1"><i class="fa fa-check"></i>Exercise 15.3.1</a></li>
<li class="chapter" data-level="" data-path="factors.html"><a href="factors.html#exercise-15.3.2"><i class="fa fa-check"></i>Exercise 15.3.2</a></li>
<li class="chapter" data-level="" data-path="factors.html"><a href="factors.html#exercise-15.3.3"><i class="fa fa-check"></i>Exercise 15.3.3</a></li>
</ul>
</li>
<li class="chapter" data-level="15.4" data-path="factors.html">
<a href="factors.html#modifying-factor-order"><i class="fa fa-check"></i><b>15.4</b> Modifying factor order</a><ul>
<li class="chapter" data-level="" data-path="factors.html"><a href="factors.html#exercise-15.4.1"><i class="fa fa-check"></i>Exercise 15.4.1</a></li>
<li class="chapter" data-level="" data-path="factors.html"><a href="factors.html#exercise-15.4.2"><i class="fa fa-check"></i>Exercise 15.4.2</a></li>
<li class="chapter" data-level="" data-path="factors.html"><a href="factors.html#exercise-15.4.3"><i class="fa fa-check"></i>Exercise 15.4.3</a></li>
</ul>
</li>
<li class="chapter" data-level="15.5" data-path="factors.html">
<a href="factors.html#modifying-factor-levels"><i class="fa fa-check"></i><b>15.5</b> Modifying factor levels</a><ul>
<li class="chapter" data-level="" data-path="factors.html"><a href="factors.html#exercise-15.5.1"><i class="fa fa-check"></i>Exercise 15.5.1</a></li>
<li class="chapter" data-level="" data-path="factors.html"><a href="factors.html#exercise-15.5.2"><i class="fa fa-check"></i>Exercise 15.5.2</a></li>
</ul>
</li>
</ul>
</li>
<li class="chapter" data-level="16" data-path="dates-and-times.html">
<a href="dates-and-times.html"><i class="fa fa-check"></i><b>16</b> Dates and times</a><ul>
<li class="chapter" data-level="16.1" data-path="dates-and-times.html"><a href="dates-and-times.html#introduction-10"><i class="fa fa-check"></i><b>16.1</b> Introduction</a></li>
<li class="chapter" data-level="16.2" data-path="dates-and-times.html">
<a href="dates-and-times.html#creating-datetimes"><i class="fa fa-check"></i><b>16.2</b> Creating date/times</a><ul>
<li class="chapter" data-level="" data-path="dates-and-times.html"><a href="dates-and-times.html#exercise-16.2.1"><i class="fa fa-check"></i>Exercise 16.2.1</a></li>
<li class="chapter" data-level="" data-path="dates-and-times.html"><a href="dates-and-times.html#exercise-16.2.2"><i class="fa fa-check"></i>Exercise 16.2.2</a></li>
<li class="chapter" data-level="" data-path="dates-and-times.html"><a href="dates-and-times.html#exercise-16.2.3"><i class="fa fa-check"></i>Exercise 16.2.3</a></li>
</ul>
</li>
<li class="chapter" data-level="16.3" data-path="dates-and-times.html">
<a href="dates-and-times.html#date-time-components"><i class="fa fa-check"></i><b>16.3</b> Date-time components</a><ul>
<li class="chapter" data-level="" data-path="dates-and-times.html"><a href="dates-and-times.html#exercise-16.3.1"><i class="fa fa-check"></i>Exercise 16.3.1</a></li>
<li class="chapter" data-level="" data-path="dates-and-times.html"><a href="dates-and-times.html#exercise-16.3.2"><i class="fa fa-check"></i>Exercise 16.3.2</a></li>
<li class="chapter" data-level="" data-path="dates-and-times.html"><a href="dates-and-times.html#exercise-16.3.3"><i class="fa fa-check"></i>Exercise 16.3.3</a></li>
<li class="chapter" data-level="" data-path="dates-and-times.html"><a href="dates-and-times.html#exercise-16.3.4"><i class="fa fa-check"></i>Exercise 16.3.4</a></li>
<li class="chapter" data-level="" data-path="dates-and-times.html"><a href="dates-and-times.html#exercise-16.3.5"><i class="fa fa-check"></i>Exercise 16.3.5</a></li>
<li class="chapter" data-level="" data-path="dates-and-times.html"><a href="dates-and-times.html#exercise-16.3.6"><i class="fa fa-check"></i>Exercise 16.3.6</a></li>
<li class="chapter" data-level="" data-path="dates-and-times.html"><a href="dates-and-times.html#exercise-16.3.7"><i class="fa fa-check"></i>Exercise 16.3.7</a></li>
</ul>
</li>
<li class="chapter" data-level="16.4" data-path="dates-and-times.html">
<a href="dates-and-times.html#time-spans"><i class="fa fa-check"></i><b>16.4</b> Time spans</a><ul>
<li class="chapter" data-level="" data-path="dates-and-times.html"><a href="dates-and-times.html#exercise-16.4.1"><i class="fa fa-check"></i>Exercise 16.4.1</a></li>
<li class="chapter" data-level="" data-path="dates-and-times.html"><a href="dates-and-times.html#exercise-16.4.2"><i class="fa fa-check"></i>Exercise 16.4.2</a></li>
<li class="chapter" data-level="" data-path="dates-and-times.html"><a href="dates-and-times.html#exercise-16.4.3"><i class="fa fa-check"></i>Exercise 16.4.3</a></li>
<li class="chapter" data-level="" data-path="dates-and-times.html"><a href="dates-and-times.html#exercise-16.4.4"><i class="fa fa-check"></i>Exercise 16.4.4</a></li>
<li class="chapter" data-level="" data-path="dates-and-times.html"><a href="dates-and-times.html#exercise-16.4.5"><i class="fa fa-check"></i>Exercise 16.4.5</a></li>
</ul>
</li>
<li class="chapter" data-level="16.5" data-path="dates-and-times.html"><a href="dates-and-times.html#time-zones"><i class="fa fa-check"></i><b>16.5</b> Time zones</a></li>
</ul>
</li>
<li class="part"><span><b>III Program</b></span></li>
<li class="chapter" data-level="17" data-path="program-intro.html"><a href="program-intro.html"><i class="fa fa-check"></i><b>17</b> Introduction</a></li>
<li class="chapter" data-level="18" data-path="pipes.html"><a href="pipes.html"><i class="fa fa-check"></i><b>18</b> Pipes</a></li>
<li class="chapter" data-level="19" data-path="functions.html">
<a href="functions.html"><i class="fa fa-check"></i><b>19</b> Functions</a><ul>
<li class="chapter" data-level="19.1" data-path="functions.html"><a href="functions.html#introduction-12"><i class="fa fa-check"></i><b>19.1</b> Introduction</a></li>
<li class="chapter" data-level="19.2" data-path="functions.html">
<a href="functions.html#when-should-you-write-a-function"><i class="fa fa-check"></i><b>19.2</b> When should you write a function?</a><ul>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html#exercise-19.2.1"><i class="fa fa-check"></i>Exercise 19.2.1</a></li>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html#exercise-19.2.2"><i class="fa fa-check"></i>Exercise 19.2.2</a></li>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html#exercise-19.2.3"><i class="fa fa-check"></i>Exercise 19.2.3</a></li>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html#exercise-19.2.4"><i class="fa fa-check"></i>Exercise 19.2.4</a></li>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html#exercise-19.2.5"><i class="fa fa-check"></i>Exercise 19.2.5</a></li>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html#exercise-19.2.6"><i class="fa fa-check"></i>Exercise 19.2.6</a></li>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html#exercise-19.2.7"><i class="fa fa-check"></i>Exercise 19.2.7</a></li>
</ul>
</li>
<li class="chapter" data-level="19.3" data-path="functions.html">
<a href="functions.html#functions-are-for-humans-and-computers"><i class="fa fa-check"></i><b>19.3</b> Functions are for humans and computers</a><ul>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html#exercise-19.3.1"><i class="fa fa-check"></i>Exercise 19.3.1</a></li>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html#exercise-19.3.2"><i class="fa fa-check"></i>Exercise 19.3.2</a></li>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html#exercise-19.3.3"><i class="fa fa-check"></i>Exercise 19.3.3</a></li>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html#exercise-19.3.4"><i class="fa fa-check"></i>Exercise 19.3.4</a></li>
</ul>
</li>
<li class="chapter" data-level="19.4" data-path="functions.html">
<a href="functions.html#conditional-execution"><i class="fa fa-check"></i><b>19.4</b> Conditional execution</a><ul>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html#exercise-19.4.1"><i class="fa fa-check"></i>Exercise 19.4.1</a></li>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html#exercise-19.4.2"><i class="fa fa-check"></i>Exercise 19.4.2</a></li>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html#exercise-19.4.3"><i class="fa fa-check"></i>Exercise 19.4.3</a></li>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html#exercise-19.4.4"><i class="fa fa-check"></i>Exercise 19.4.4</a></li>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html#exercise-19.4.5"><i class="fa fa-check"></i>Exercise 19.4.5</a></li>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html#exercise-19.4.6"><i class="fa fa-check"></i>Exercise 19.4.6</a></li>
</ul>
</li>
<li class="chapter" data-level="19.5" data-path="functions.html">
<a href="functions.html#function-arguments"><i class="fa fa-check"></i><b>19.5</b> Function arguments</a><ul>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html#exercise-19.5.1"><i class="fa fa-check"></i>Exercise 19.5.1</a></li>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html#exercise-19.5.2"><i class="fa fa-check"></i>Exercise 19.5.2</a></li>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html#exercise-19.5.3"><i class="fa fa-check"></i>Exercise 19.5.3</a></li>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html#exercise-19.5.4"><i class="fa fa-check"></i>Exercise 19.5.4</a></li>
</ul>
</li>
<li class="chapter" data-level="19.6" data-path="functions.html"><a href="functions.html#return-values"><i class="fa fa-check"></i><b>19.6</b> Return values</a></li>
<li class="chapter" data-level="19.7" data-path="functions.html"><a href="functions.html#environment"><i class="fa fa-check"></i><b>19.7</b> Environment</a></li>
</ul>
</li>
<li class="chapter" data-level="20" data-path="vectors.html">
<a href="vectors.html"><i class="fa fa-check"></i><b>20</b> Vectors</a><ul>
<li class="chapter" data-level="20.1" data-path="vectors.html"><a href="vectors.html#introduction-13"><i class="fa fa-check"></i><b>20.1</b> Introduction</a></li>
<li class="chapter" data-level="20.2" data-path="vectors.html"><a href="vectors.html#vector-basics"><i class="fa fa-check"></i><b>20.2</b> Vector basics</a></li>
<li class="chapter" data-level="20.3" data-path="vectors.html">
<a href="vectors.html#important-types-of-atomic-vector"><i class="fa fa-check"></i><b>20.3</b> Important types of atomic vector</a><ul>
<li class="chapter" data-level="" data-path="vectors.html"><a href="vectors.html#exercise-20.3.1"><i class="fa fa-check"></i>Exercise 20.3.1</a></li>
<li class="chapter" data-level="" data-path="vectors.html"><a href="vectors.html#exercise-20.3.2"><i class="fa fa-check"></i>Exercise 20.3.2</a></li>
<li class="chapter" data-level="" data-path="vectors.html"><a href="vectors.html#exercise-20.3.3"><i class="fa fa-check"></i>Exercise 20.3.3</a></li>
<li class="chapter" data-level="" data-path="vectors.html"><a href="vectors.html#exercise-20.3.4"><i class="fa fa-check"></i>Exercise 20.3.4</a></li>
<li class="chapter" data-level="" data-path="vectors.html"><a href="vectors.html#exercise-20.3.5"><i class="fa fa-check"></i>Exercise 20.3.5</a></li>
</ul>
</li>
<li class="chapter" data-level="20.4" data-path="vectors.html">
<a href="vectors.html#using-atomic-vectors"><i class="fa fa-check"></i><b>20.4</b> Using atomic vectors</a><ul>
<li class="chapter" data-level="" data-path="vectors.html"><a href="vectors.html#exercise-20.4.1"><i class="fa fa-check"></i>Exercise 20.4.1</a></li>
<li class="chapter" data-level="" data-path="vectors.html"><a href="vectors.html#exercise-20.4.2"><i class="fa fa-check"></i>Exercise 20.4.2</a></li>
<li class="chapter" data-level="" data-path="vectors.html"><a href="vectors.html#exercise-20.4.3"><i class="fa fa-check"></i>Exercise 20.4.3</a></li>
<li class="chapter" data-level="" data-path="vectors.html"><a href="vectors.html#exercise-20.4.4"><i class="fa fa-check"></i>Exercise 20.4.4</a></li>
<li class="chapter" data-level="" data-path="vectors.html"><a href="vectors.html#exercise-20.4.5"><i class="fa fa-check"></i>Exercise 20.4.5</a></li>
<li class="chapter" data-level="" data-path="vectors.html"><a href="vectors.html#exercise-20.4.6"><i class="fa fa-check"></i>Exercise 20.4.6</a></li>
</ul>
</li>
<li class="chapter" data-level="20.5" data-path="vectors.html">
<a href="vectors.html#lists"><i class="fa fa-check"></i><b>20.5</b> Recursive vectors (lists)</a><ul>
<li class="chapter" data-level="" data-path="vectors.html"><a href="vectors.html#exercise-20.5.1"><i class="fa fa-check"></i>Exercise 20.5.1</a></li>
<li class="chapter" data-level="" data-path="vectors.html"><a href="vectors.html#exercise-20.5.2"><i class="fa fa-check"></i>Exercise 20.5.2</a></li>
</ul>
</li>
<li class="chapter" data-level="20.6" data-path="vectors.html"><a href="vectors.html#attributes"><i class="fa fa-check"></i><b>20.6</b> Attributes</a></li>
<li class="chapter" data-level="20.7" data-path="vectors.html">
<a href="vectors.html#augmented-vectors"><i class="fa fa-check"></i><b>20.7</b> Augmented vectors</a><ul>
<li class="chapter" data-level="" data-path="vectors.html"><a href="vectors.html#exercise-20.7.1"><i class="fa fa-check"></i>Exercise 20.7.1</a></li>
<li class="chapter" data-level="" data-path="vectors.html"><a href="vectors.html#exercise-20.7.2"><i class="fa fa-check"></i>Exercise 20.7.2</a></li>
<li class="chapter" data-level="" data-path="vectors.html"><a href="vectors.html#exercise-20.7.3"><i class="fa fa-check"></i>Exercise 20.7.3</a></li>
</ul>
</li>
</ul>
</li>
<li class="chapter" data-level="21" data-path="iteration.html">
<a href="iteration.html"><i class="fa fa-check"></i><b>21</b> Iteration</a><ul>
<li class="chapter" data-level="21.1" data-path="iteration.html"><a href="iteration.html#introduction-14"><i class="fa fa-check"></i><b>21.1</b> Introduction</a></li>
<li class="chapter" data-level="21.2" data-path="iteration.html">
<a href="iteration.html#for-loops"><i class="fa fa-check"></i><b>21.2</b> For loops</a><ul>
<li class="chapter" data-level="" data-path="iteration.html"><a href="iteration.html#exercise-21.2.1"><i class="fa fa-check"></i>Exercise 21.2.1</a></li>
<li class="chapter" data-level="" data-path="iteration.html"><a href="iteration.html#exercise-21.2.2"><i class="fa fa-check"></i>Exercise 21.2.2</a></li>
<li class="chapter" data-level="" data-path="iteration.html"><a href="iteration.html#exercise-21.2.3"><i class="fa fa-check"></i>Exercise 21.2.3</a></li>
</ul>
</li>
<li class="chapter" data-level="21.3" data-path="iteration.html">
<a href="iteration.html#for-loop-variations"><i class="fa fa-check"></i><b>21.3</b> For loop variations</a><ul>
<li class="chapter" data-level="" data-path="iteration.html"><a href="iteration.html#exercise-21.3.1"><i class="fa fa-check"></i>Exercise 21.3.1</a></li>
<li class="chapter" data-level="" data-path="iteration.html"><a href="iteration.html#exercise-21.3.2"><i class="fa fa-check"></i>Exercise 21.3.2</a></li>
<li class="chapter" data-level="" data-path="iteration.html"><a href="iteration.html#exercise-21.3.3"><i class="fa fa-check"></i>Exercise 21.3.3</a></li>
<li class="chapter" data-level="" data-path="iteration.html"><a href="iteration.html#exercise-21.3.4"><i class="fa fa-check"></i>Exercise 21.3.4</a></li>
</ul>
</li>
<li class="chapter" data-level="21.4" data-path="iteration.html">
<a href="iteration.html#for-loops-vs.functionals"><i class="fa fa-check"></i><b>21.4</b> For loops vs. functionals</a><ul>
<li class="chapter" data-level="" data-path="iteration.html"><a href="iteration.html#exercise-21.4.1"><i class="fa fa-check"></i>Exercise 21.4.1</a></li>
<li class="chapter" data-level="" data-path="iteration.html"><a href="iteration.html#exercise-21.4.2"><i class="fa fa-check"></i>Exercise 21.4.2</a></li>
</ul>
</li>
<li class="chapter" data-level="21.5" data-path="iteration.html">
<a href="iteration.html#the-map-functions"><i class="fa fa-check"></i><b>21.5</b> The map functions</a><ul>
<li class="chapter" data-level="" data-path="iteration.html"><a href="iteration.html#exercise-21.5.1"><i class="fa fa-check"></i>Exercise 21.5.1</a></li>
<li class="chapter" data-level="" data-path="iteration.html"><a href="iteration.html#exercise-21.5.2"><i class="fa fa-check"></i>Exercise 21.5.2</a></li>
<li class="chapter" data-level="" data-path="iteration.html"><a href="iteration.html#exercise-21.5.3"><i class="fa fa-check"></i>Exercise 21.5.3</a></li>
<li class="chapter" data-level="" data-path="iteration.html"><a href="iteration.html#exercise-21.5.4"><i class="fa fa-check"></i>Exercise 21.5.4</a></li>
<li class="chapter" data-level="" data-path="iteration.html"><a href="iteration.html#exercise-21.5.5"><i class="fa fa-check"></i>Exercise 21.5.5</a></li>
</ul>
</li>
<li class="chapter" data-level="21.6" data-path="iteration.html"><a href="iteration.html#dealing-with-failure"><i class="fa fa-check"></i><b>21.6</b> Dealing with failure</a></li>
<li class="chapter" data-level="21.7" data-path="iteration.html"><a href="iteration.html#mapping-over-multiple-arguments"><i class="fa fa-check"></i><b>21.7</b> Mapping over multiple arguments</a></li>
<li class="chapter" data-level="21.8" data-path="iteration.html"><a href="iteration.html#walk"><i class="fa fa-check"></i><b>21.8</b> Walk</a></li>
<li class="chapter" data-level="21.9" data-path="iteration.html">
<a href="iteration.html#other-patterns-of-for-loops"><i class="fa fa-check"></i><b>21.9</b> Other patterns of for loops</a><ul>
<li class="chapter" data-level="" data-path="iteration.html"><a href="iteration.html#exercise-21.9.1"><i class="fa fa-check"></i>Exercise 21.9.1</a></li>
<li class="chapter" data-level="" data-path="iteration.html"><a href="iteration.html#exercise-21.9.2"><i class="fa fa-check"></i>Exercise 21.9.2</a></li>
<li class="chapter" data-level="" data-path="iteration.html"><a href="iteration.html#exercise-21.9.3"><i class="fa fa-check"></i>Exercise 21.9.3</a></li>
</ul>
</li>
</ul>
</li>
<li class="part"><span><b>IV Model</b></span></li>
<li class="chapter" data-level="22" data-path="model-intro.html"><a href="model-intro.html"><i class="fa fa-check"></i><b>22</b> Introduction</a></li>
<li class="chapter" data-level="23" data-path="model-basics.html">
<a href="model-basics.html"><i class="fa fa-check"></i><b>23</b> Model basics</a><ul>
<li class="chapter" data-level="23.1" data-path="model-basics.html"><a href="model-basics.html#introduction-15"><i class="fa fa-check"></i><b>23.1</b> Introduction</a></li>
<li class="chapter" data-level="23.2" data-path="model-basics.html">
<a href="model-basics.html#a-simple-model"><i class="fa fa-check"></i><b>23.2</b> A simple model</a><ul>
<li class="chapter" data-level="" data-path="model-basics.html"><a href="model-basics.html#exercise-23.2.1"><i class="fa fa-check"></i>Exercise 23.2.1</a></li>
<li class="chapter" data-level="" data-path="model-basics.html"><a href="model-basics.html#exercise-23.2.2"><i class="fa fa-check"></i>Exercise 23.2.2</a></li>
<li class="chapter" data-level="" data-path="model-basics.html"><a href="model-basics.html#exercise-23.2.3"><i class="fa fa-check"></i>Exercise 23.2.3</a></li>
</ul>
</li>
<li class="chapter" data-level="23.3" data-path="model-basics.html">
<a href="model-basics.html#visualising-models"><i class="fa fa-check"></i><b>23.3</b> Visualising models</a><ul>
<li class="chapter" data-level="" data-path="model-basics.html"><a href="model-basics.html#exercise-23.3.1"><i class="fa fa-check"></i>Exercise 23.3.1</a></li>
<li class="chapter" data-level="" data-path="model-basics.html"><a href="model-basics.html#exercise-23.3.2"><i class="fa fa-check"></i>Exercise 23.3.2</a></li>
<li class="chapter" data-level="" data-path="model-basics.html"><a href="model-basics.html#exercise-23.3.3"><i class="fa fa-check"></i>Exercise 23.3.3</a></li>
<li class="chapter" data-level="" data-path="model-basics.html"><a href="model-basics.html#exercise-23.3.4"><i class="fa fa-check"></i>Exercise 23.3.4</a></li>
</ul>
</li>
<li class="chapter" data-level="23.4" data-path="model-basics.html">
<a href="model-basics.html#formulas-and-model-families"><i class="fa fa-check"></i><b>23.4</b> Formulas and model families</a><ul>
<li class="chapter" data-level="" data-path="model-basics.html"><a href="model-basics.html#exercise-23.4.1"><i class="fa fa-check"></i>Exercise 23.4.1</a></li>
<li class="chapter" data-level="" data-path="model-basics.html"><a href="model-basics.html#exercise-23.4.2"><i class="fa fa-check"></i>Exercise 23.4.2</a></li>
<li class="chapter" data-level="" data-path="model-basics.html"><a href="model-basics.html#exercise-23.4.3"><i class="fa fa-check"></i>Exercise 23.4.3</a></li>
<li class="chapter" data-level="" data-path="model-basics.html"><a href="model-basics.html#exercise-23.4.4"><i class="fa fa-check"></i>Exercise 23.4.4</a></li>
</ul>
</li>
<li class="chapter" data-level="23.5" data-path="model-basics.html"><a href="model-basics.html#missing-values-5"><i class="fa fa-check"></i><b>23.5</b> Missing values</a></li>
<li class="chapter" data-level="23.6" data-path="model-basics.html"><a href="model-basics.html#other-model-families"><i class="fa fa-check"></i><b>23.6</b> Other model families</a></li>
</ul>
</li>
<li class="chapter" data-level="24" data-path="model-building.html">
<a href="model-building.html"><i class="fa fa-check"></i><b>24</b> Model building</a><ul>
<li class="chapter" data-level="24.1" data-path="model-building.html"><a href="model-building.html#introduction-16"><i class="fa fa-check"></i><b>24.1</b> Introduction</a></li>
<li class="chapter" data-level="24.2" data-path="model-building.html">
<a href="model-building.html#diamond-prices"><i class="fa fa-check"></i><b>24.2</b> Why are low quality diamonds more expensive?</a><ul>
<li class="chapter" data-level="" data-path="model-building.html"><a href="model-building.html#exercise-24.2.1"><i class="fa fa-check"></i>Exercise 24.2.1</a></li>
<li class="chapter" data-level="" data-path="model-building.html"><a href="model-building.html#exercise-24.2.2"><i class="fa fa-check"></i>Exercise 24.2.2</a></li>
<li class="chapter" data-level="" data-path="model-building.html"><a href="model-building.html#exercise-24.2.3"><i class="fa fa-check"></i>Exercise 24.2.3</a></li>
<li class="chapter" data-level="" data-path="model-building.html"><a href="model-building.html#exercise-24.2.4"><i class="fa fa-check"></i>Exercise 24.2.4</a></li>
</ul>
</li>
<li class="chapter" data-level="24.3" data-path="model-building.html">
<a href="model-building.html#what-affects-the-number-of-daily-flights"><i class="fa fa-check"></i><b>24.3</b> What affects the number of daily flights?</a><ul>
<li class="chapter" data-level="" data-path="model-building.html"><a href="model-building.html#exercise-24.3.1"><i class="fa fa-check"></i>Exercise 24.3.1</a></li>
<li class="chapter" data-level="" data-path="model-building.html"><a href="model-building.html#exercise-24.3.2"><i class="fa fa-check"></i>Exercise 24.3.2</a></li>
<li class="chapter" data-level="" data-path="model-building.html"><a href="model-building.html#exercise-24.3.3"><i class="fa fa-check"></i>Exercise 24.3.3</a></li>
<li class="chapter" data-level="" data-path="model-building.html"><a href="model-building.html#exercise-24.3.4"><i class="fa fa-check"></i>Exercise 24.3.4</a></li>
<li class="chapter" data-level="" data-path="model-building.html"><a href="model-building.html#exercise-24.3.5"><i class="fa fa-check"></i>Exercise 24.3.5</a></li>
<li class="chapter" data-level="" data-path="model-building.html"><a href="model-building.html#exercise-24.3.6"><i class="fa fa-check"></i>Exercise 24.3.6</a></li>
<li class="chapter" data-level="" data-path="model-building.html"><a href="model-building.html#exercise-24.3.7"><i class="fa fa-check"></i>Exercise 24.3.7</a></li>
<li class="chapter" data-level="" data-path="model-building.html"><a href="model-building.html#exercise-24.3.8"><i class="fa fa-check"></i>Exercise 24.3.8</a></li>
</ul>
</li>
<li class="chapter" data-level="24.4" data-path="model-building.html"><a href="model-building.html#learning-more-about-models"><i class="fa fa-check"></i><b>24.4</b> Learning more about models</a></li>
</ul>
</li>
<li class="chapter" data-level="25" data-path="many-models.html">
<a href="many-models.html"><i class="fa fa-check"></i><b>25</b> Many models</a><ul>
<li class="chapter" data-level="25.1" data-path="many-models.html"><a href="many-models.html#introduction-17"><i class="fa fa-check"></i><b>25.1</b> Introduction</a></li>
<li class="chapter" data-level="25.2" data-path="many-models.html">
<a href="many-models.html#gapminder"><i class="fa fa-check"></i><b>25.2</b> gapminder</a><ul>
<li class="chapter" data-level="" data-path="many-models.html"><a href="many-models.html#exercise-25.2.1"><i class="fa fa-check"></i>Exercise 25.2.1</a></li>
<li class="chapter" data-level="" data-path="many-models.html"><a href="many-models.html#exercise-25.2.2"><i class="fa fa-check"></i>Exercise 25.2.2</a></li>
<li class="chapter" data-level="" data-path="many-models.html"><a href="many-models.html#exercise-25.2.3"><i class="fa fa-check"></i>Exercise 25.2.3</a></li>
</ul>
</li>
<li class="chapter" data-level="25.3" data-path="many-models.html"><a href="many-models.html#list-columns-1"><i class="fa fa-check"></i><b>25.3</b> List-columns</a></li>
<li class="chapter" data-level="25.4" data-path="many-models.html">
<a href="many-models.html#creating-list-columns"><i class="fa fa-check"></i><b>25.4</b> Creating list-columns</a><ul>
<li class="chapter" data-level="" data-path="many-models.html"><a href="many-models.html#exercise-25.4.1"><i class="fa fa-check"></i>Exercise 25.4.1</a></li>
<li class="chapter" data-level="" data-path="many-models.html"><a href="many-models.html#exercise-25.4.2"><i class="fa fa-check"></i>Exercise 25.4.2</a></li>
<li class="chapter" data-level="" data-path="many-models.html"><a href="many-models.html#exercise-25.4.3"><i class="fa fa-check"></i>Exercise 25.4.3</a></li>
<li class="chapter" data-level="" data-path="many-models.html"><a href="many-models.html#exercise-25.4.4"><i class="fa fa-check"></i>Exercise 25.4.4</a></li>
</ul>
</li>
<li class="chapter" data-level="25.5" data-path="many-models.html">
<a href="many-models.html#simplifying-list-columns"><i class="fa fa-check"></i><b>25.5</b> Simplifying list-columns</a><ul>
<li class="chapter" data-level="" data-path="many-models.html"><a href="many-models.html#exercise-25.5.1"><i class="fa fa-check"></i>Exercise 25.5.1</a></li>
<li class="chapter" data-level="" data-path="many-models.html"><a href="many-models.html#exercise-25.5.2"><i class="fa fa-check"></i>Exercise 25.5.2</a></li>
</ul>
</li>
<li class="chapter" data-level="25.6" data-path="many-models.html"><a href="many-models.html#making-tidy-data-with-broom"><i class="fa fa-check"></i><b>25.6</b> Making tidy data with broom</a></li>
</ul>
</li>
<li class="part"><span><b>V Communicate</b></span></li>
<li class="chapter" data-level="26" data-path="communicate-intro.html"><a href="communicate-intro.html"><i class="fa fa-check"></i><b>26</b> Introduction</a></li>
<li class="chapter" data-level="27" data-path="r-markdown.html">
<a href="r-markdown.html"><i class="fa fa-check"></i><b>27</b> R Markdown</a><ul>
<li class="chapter" data-level="27.1" data-path="r-markdown.html"><a href="r-markdown.html#introduction-18"><i class="fa fa-check"></i><b>27.1</b> Introduction</a></li>
<li class="chapter" data-level="27.2" data-path="r-markdown.html">
<a href="r-markdown.html#r-markdown-basics"><i class="fa fa-check"></i><b>27.2</b> R Markdown basics</a><ul>
<li class="chapter" data-level="" data-path="r-markdown.html"><a href="r-markdown.html#exercise-27.2.1"><i class="fa fa-check"></i>Exercise 27.2.1</a></li>
<li class="chapter" data-level="" data-path="r-markdown.html"><a href="r-markdown.html#exercise-27.2.2"><i class="fa fa-check"></i>Exercise 27.2.2</a></li>
<li class="chapter" data-level="" data-path="r-markdown.html"><a href="r-markdown.html#exercise-27.2.3"><i class="fa fa-check"></i>Exercise 27.2.3</a></li>
<li class="chapter" data-level="" data-path="r-markdown.html"><a href="r-markdown.html#exercise-27.2.4"><i class="fa fa-check"></i>Exercise 27.2.4</a></li>
</ul>
</li>
<li class="chapter" data-level="27.3" data-path="r-markdown.html">
<a href="r-markdown.html#text-formatting-with-markdown"><i class="fa fa-check"></i><b>27.3</b> Text formatting with Markdown</a><ul>
<li class="chapter" data-level="" data-path="r-markdown.html"><a href="r-markdown.html#exercise-27.3.1"><i class="fa fa-check"></i>Exercise 27.3.1</a></li>
<li class="chapter" data-level="" data-path="r-markdown.html"><a href="r-markdown.html#exercise-27.3.2"><i class="fa fa-check"></i>Exercise 27.3.2</a></li>
<li class="chapter" data-level="" data-path="r-markdown.html"><a href="r-markdown.html#exercise-27.3.3"><i class="fa fa-check"></i>Exercise 27.3.3</a></li>
</ul>
</li>
<li class="chapter" data-level="27.4" data-path="r-markdown.html">
<a href="r-markdown.html#code-chunks"><i class="fa fa-check"></i><b>27.4</b> Code chunks</a><ul>
<li class="chapter" data-level="" data-path="r-markdown.html"><a href="r-markdown.html#exercise-27.4.1"><i class="fa fa-check"></i>Exercise 27.4.1</a></li>
<li class="chapter" data-level="" data-path="r-markdown.html"><a href="r-markdown.html#exercise-27.4.2"><i class="fa fa-check"></i>Exercise 27.4.2</a></li>
<li class="chapter" data-level="" data-path="r-markdown.html"><a href="r-markdown.html#exercise-27.4.3"><i class="fa fa-check"></i>Exercise 27.4.3</a></li>
<li class="chapter" data-level="" data-path="r-markdown.html"><a href="r-markdown.html#exercise-27.4.4"><i class="fa fa-check"></i>Exercise 27.4.4</a></li>
</ul>
</li>
<li class="chapter" data-level="27.5" data-path="r-markdown.html"><a href="r-markdown.html#troubleshooting"><i class="fa fa-check"></i><b>27.5</b> Troubleshooting</a></li>
<li class="chapter" data-level="27.6" data-path="r-markdown.html"><a href="r-markdown.html#yaml-header"><i class="fa fa-check"></i><b>27.6</b> YAML header</a></li>
<li class="chapter" data-level="27.7" data-path="r-markdown.html"><a href="r-markdown.html#learning-more-3"><i class="fa fa-check"></i><b>27.7</b> Learning more</a></li>
</ul>
</li>
<li class="chapter" data-level="28" data-path="graphics-for-communication.html">
<a href="graphics-for-communication.html"><i class="fa fa-check"></i><b>28</b> Graphics for communication</a><ul>
<li class="chapter" data-level="28.1" data-path="graphics-for-communication.html"><a href="graphics-for-communication.html#introduction-19"><i class="fa fa-check"></i><b>28.1</b> Introduction</a></li>
<li class="chapter" data-level="28.2" data-path="graphics-for-communication.html">
<a href="graphics-for-communication.html#label"><i class="fa fa-check"></i><b>28.2</b> Label</a><ul>
<li class="chapter" data-level="" data-path="graphics-for-communication.html"><a href="graphics-for-communication.html#exercise-28.2.1"><i class="fa fa-check"></i>Exercise 28.2.1</a></li>
<li class="chapter" data-level="" data-path="graphics-for-communication.html"><a href="graphics-for-communication.html#exercise-28.2.2"><i class="fa fa-check"></i>Exercise 28.2.2</a></li>
<li class="chapter" data-level="" data-path="graphics-for-communication.html"><a href="graphics-for-communication.html#exercise-28.2.3"><i class="fa fa-check"></i>Exercise 28.2.3</a></li>
</ul>
</li>
<li class="chapter" data-level="28.3" data-path="graphics-for-communication.html">
<a href="graphics-for-communication.html#annotations"><i class="fa fa-check"></i><b>28.3</b> Annotations</a><ul>
<li class="chapter" data-level="" data-path="graphics-for-communication.html"><a href="graphics-for-communication.html#exercise-28.3.1"><i class="fa fa-check"></i>Exercise 28.3.1</a></li>
<li class="chapter" data-level="" data-path="graphics-for-communication.html"><a href="graphics-for-communication.html#exercise-28.3.2"><i class="fa fa-check"></i>Exercise 28.3.2</a></li>
<li class="chapter" data-level="" data-path="graphics-for-communication.html"><a href="graphics-for-communication.html#exercise-28.3.3"><i class="fa fa-check"></i>Exercise 28.3.3</a></li>
<li class="chapter" data-level="" data-path="graphics-for-communication.html"><a href="graphics-for-communication.html#exercise-28.3.4"><i class="fa fa-check"></i>Exercise 28.3.4</a></li>
<li class="chapter" data-level="" data-path="graphics-for-communication.html"><a href="graphics-for-communication.html#exercise-28.3.5"><i class="fa fa-check"></i>Exercise 28.3.5</a></li>
</ul>
</li>
<li class="chapter" data-level="28.4" data-path="graphics-for-communication.html">
<a href="graphics-for-communication.html#scales"><i class="fa fa-check"></i><b>28.4</b> Scales</a><ul>
<li class="chapter" data-level="" data-path="graphics-for-communication.html"><a href="graphics-for-communication.html#exercise-28.4.1"><i class="fa fa-check"></i>Exercise 28.4.1</a></li>
<li class="chapter" data-level="" data-path="graphics-for-communication.html"><a href="graphics-for-communication.html#exercise-28.4.2"><i class="fa fa-check"></i>Exercise 28.4.2</a></li>
<li class="chapter" data-level="" data-path="graphics-for-communication.html"><a href="graphics-for-communication.html#exercise-28.4.3"><i class="fa fa-check"></i>Exercise 28.4.3</a></li>
<li class="chapter" data-level="" data-path="graphics-for-communication.html"><a href="graphics-for-communication.html#exercise-28.4.4"><i class="fa fa-check"></i>Exercise 28.4.4</a></li>
</ul>
</li>
<li class="chapter" data-level="28.5" data-path="graphics-for-communication.html"><a href="graphics-for-communication.html#zooming"><i class="fa fa-check"></i><b>28.5</b> Zooming</a></li>
<li class="chapter" data-level="28.6" data-path="graphics-for-communication.html"><a href="graphics-for-communication.html#themes"><i class="fa fa-check"></i><b>28.6</b> Themes</a></li>
<li class="chapter" data-level="28.7" data-path="graphics-for-communication.html"><a href="graphics-for-communication.html#saving-your-plots"><i class="fa fa-check"></i><b>28.7</b> Saving your plots</a></li>
<li class="chapter" data-level="28.8" data-path="graphics-for-communication.html"><a href="graphics-for-communication.html#learning-more-4"><i class="fa fa-check"></i><b>28.8</b> Learning more</a></li>
</ul>
</li>
<li class="chapter" data-level="29" data-path="r-markdown-formats.html"><a href="r-markdown-formats.html"><i class="fa fa-check"></i><b>29</b> R Markdown formats</a></li>
<li class="chapter" data-level="30" data-path="r-markdown-workflow.html"><a href="r-markdown-workflow.html"><i class="fa fa-check"></i><b>30</b> R Markdown workflow</a></li>
<li class="part"><span><b>VI Appendixes</b></span></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider">
<li><a href="https://github.com/rstudio/bookdown">Proudly published with bookdown</a></li>

</ul></nav>
</div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">R for Data Science: Exercise Solutions</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-"><div class="alert alert-info hints-alert">
  <div class="hints-icon">
    <i class="fa fa-comments-o"></i>
  </div>
  <div class="hints-container">
    <b>I need your help!</b>
    <p>
    If you find any typos, errors, or places where the text may be improved, please let me know.
    The best ways to provide feedback are by GitHub or hypothes.is annotations.
    </p>

    <p>
      <i class="fa fa-github"></i>
      Opening an <a href="https://github.com/jrnold/r4ds-exercise-solutions/issues">issue</a> or submitting a <a href="https://github.com/jrnold/r4ds-exercise-solutions/pulls">pull request</a> on <a href="https://github.com/jrnold/r4ds-exercise-solutions">GitHub</a>
    </p>
    <p>
      <img style="display: inline;" src="https://hypothes.is/organizations/__default__/logo" alt="Hypothesis">
      Adding an annotation using <a href="https://hypothes.is">hypothes.is</a>.
      To add an annotation, <span style="background-color: #3297FD; color: white">select some text</span> and then click the
      <span class="svg-icon--inline"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewbox="0 0 16 16" class="annotator-adder-actions__icon"><path fill="currentColor" fill-rule="nonzero" d="M15 0c.27 0 .505.099.703.297A.961.961 0 0116 1v15l-4-3H1a.974.974 0 01-.703-.29A.953.953 0 010 12V1C0 .719.096.482.29.29A.966.966 0 011 0h14zM7 3l-.469.063c-.312.041-.656.187-1.031.437-.375.25-.719.646-1.031 1.188C4.156 5.229 4 6 4 7l.002.063.006.062a.896.896 0 01.008.11l-.002.074-.006.066a1.447 1.447 0 00.43 1.188C4.729 8.854 5.082 9 5.5 9c.417 0 .77-.146 1.063-.438C6.854 8.271 7 7.918 7 7.5c0-.417-.146-.77-.438-1.063A1.447 1.447 0 005.5 6c-.073 0-.146.005-.219.016-.073.01-.14.026-.203.046.177-1.03.542-1.632 1.094-1.804L7 4V3zm5 0l-.469.063c-.312.041-.656.187-1.031.437-.375.25-.719.646-1.031 1.188C9.156 5.229 9 6 9 7l.002.063.006.062a.896.896 0 01.008.11l-.002.074-.006.066a1.447 1.447 0 00.43 1.188c.291.291.645.437 1.062.437.417 0 .77-.146 1.063-.438.291-.291.437-.645.437-1.062 0-.417-.146-.77-.438-1.063A1.447 1.447 0 0010.5 6c-.073 0-.146.005-.219.016-.073.01-.14.026-.203.046.177-1.03.542-1.632 1.094-1.804L12 4V3z"></path></svg></span>
      on the pop-up menu.
      To see the annotations of others, click the
      <span class="svg-icon--inline"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewbox="0 0 16 16" class=""><g fill-rule="evenodd"><rect fill="none" stroke="none" x="0" y="0" width="16" height="16"></rect><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 12L6 8l4-4"></path></g></svg></span>
      in the upper right-hand corner of the page.
    </p>
  </div>
</div>
<div id="relational-data" class="section level1 r4ds-section">
<h1>
<a href="#relational-data" class="anchor section-link" aria-hidden="true"><i class="fa fa-link" aria-hidden="true"></i></a><span class="header-section-number">13</span> Relational data<a href="https://r4ds.had.co.nz/relational-data.html#relational-data" class="r4ds-section-link section-link" aria-hidden="true"><i class="fa fa-external-link" aria-hidden="true"></i></a>
</h1>
<div id="introduction-7" class="section level2 r4ds-section">
<h2>
<a href="#introduction-7" class="anchor section-link" aria-hidden="true"><i class="fa fa-link" aria-hidden="true"></i></a><span class="header-section-number">13.1</span> Introduction<a href="https://r4ds.had.co.nz/relational-data.html#introduction-7" class="r4ds-section-link section-link" aria-hidden="true"><i class="fa fa-external-link" aria-hidden="true"></i></a>
</h2>
<p>The datamodelr package is used to draw database schema.</p>
<div class="sourceCode" id="cb390"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb390-1" data-line-number="1"><span class="kw">library</span>(<span class="st">"tidyverse"</span>)</a>
<a class="sourceLine" id="cb390-2" data-line-number="2"><span class="kw">library</span>(<span class="st">"nycflights13"</span>)</a>
<a class="sourceLine" id="cb390-3" data-line-number="3"><span class="kw">library</span>(<span class="st">"viridis"</span>)</a>
<a class="sourceLine" id="cb390-4" data-line-number="4"><span class="kw">library</span>(<span class="st">"datamodelr"</span>)</a></code></pre></div>
</div>
<div id="nycflights13-relational" class="section level2 r4ds-section">
<h2>
<a href="#nycflights13-relational" class="anchor section-link" aria-hidden="true"><i class="fa fa-link" aria-hidden="true"></i></a><span class="header-section-number">13.2</span> nycflights13<a href="https://r4ds.had.co.nz/relational-data.html#nycflights13-relational" class="r4ds-section-link section-link" aria-hidden="true"><i class="fa fa-external-link" aria-hidden="true"></i></a>
</h2>
<div id="exercise-13.2.1" class="section level3 unnumbered exercise" data-number="13.2.1">
<h3>Exercise 13.2.1<a href="#exercise-13.2.1" class="anchor section-link" aria-hidden="true"><i class="fa fa-link" aria-hidden="true"></i></a>
</h3>
<div class="question">
<p>Imagine you wanted to draw (approximately) the route each plane flies from its origin to its destination.
What variables would you need?
What tables would you need to combine?</p>
</div>
<div class="answer">
<p>Drawing the routes requires the latitude and longitude of the origin and the destination airports of each flight.
This requires the <code>flights</code> and <code>airports</code> tables.
The <code>flights</code> table has the origin (<code>origin</code>) and destination (<code>dest</code>) airport of each flight.
The <code>airports</code> table has the longitude (<code>lon</code>) and latitude (<code>lat</code>) of each airport.
To get the latitude and longitude for the origin and destination of each flight,
requires two joins for <code>flights</code> to <code>airports</code>,
once for the latitude and longitude of the origin airport,
and once for the latitude and longitude of the destination airport.
I use an inner join in order to drop any flights with missing airports since they will not have a longitude or latitude.</p>
<div class="sourceCode" id="cb391"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb391-1" data-line-number="1">flights_latlon &lt;-<span class="st"> </span>flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb391-2" data-line-number="2"><span class="st">  </span><span class="kw">inner_join</span>(<span class="kw">select</span>(airports, <span class="dt">origin =</span> faa, <span class="dt">origin_lat =</span> lat, <span class="dt">origin_lon =</span> lon),</a>
<a class="sourceLine" id="cb391-3" data-line-number="3">    <span class="dt">by =</span> <span class="st">"origin"</span></a>
<a class="sourceLine" id="cb391-4" data-line-number="4">  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb391-5" data-line-number="5"><span class="st">  </span><span class="kw">inner_join</span>(<span class="kw">select</span>(airports, <span class="dt">dest =</span> faa, <span class="dt">dest_lat =</span> lat, <span class="dt">dest_lon =</span> lon),</a>
<a class="sourceLine" id="cb391-6" data-line-number="6">    <span class="dt">by =</span> <span class="st">"dest"</span></a>
<a class="sourceLine" id="cb391-7" data-line-number="7">  )</a></code></pre></div>
<p>This plots the approximate flight paths of the first 100 flights in the <code>flights</code> dataset.</p>
<div class="sourceCode" id="cb392"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb392-1" data-line-number="1">flights_latlon <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb392-2" data-line-number="2"><span class="st">  </span><span class="kw">slice</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">100</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb392-3" data-line-number="3"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(</a>
<a class="sourceLine" id="cb392-4" data-line-number="4">    <span class="dt">x =</span> origin_lon, <span class="dt">xend =</span> dest_lon,</a>
<a class="sourceLine" id="cb392-5" data-line-number="5">    <span class="dt">y =</span> origin_lat, <span class="dt">yend =</span> dest_lat</a>
<a class="sourceLine" id="cb392-6" data-line-number="6">  )) <span class="op">+</span></a>
<a class="sourceLine" id="cb392-7" data-line-number="7"><span class="st">  </span><span class="kw">borders</span>(<span class="st">"state"</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb392-8" data-line-number="8"><span class="st">  </span><span class="kw">geom_segment</span>(<span class="dt">arrow =</span> <span class="kw">arrow</span>(<span class="dt">length =</span> <span class="kw">unit</span>(<span class="fl">0.1</span>, <span class="st">"cm"</span>))) <span class="op">+</span></a>
<a class="sourceLine" id="cb392-9" data-line-number="9"><span class="st">  </span><span class="kw">coord_quickmap</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb392-10" data-line-number="10"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">y =</span> <span class="st">"Latitude"</span>, <span class="dt">x =</span> <span class="st">"Longitude"</span>)</a></code></pre></div>
<p><img src="relational-data_files/figure-html/unnamed-chunk-2-1.png" width="70%" style="display: block; margin: auto;"></p>
</div>
</div>
<div id="exercise-13.2.2" class="section level3 unnumbered exercise" data-number="13.2.2">
<h3>Exercise 13.2.2<a href="#exercise-13.2.2" class="anchor section-link" aria-hidden="true"><i class="fa fa-link" aria-hidden="true"></i></a>
</h3>
<div class="question">
<p>I forgot to draw the relationship between <code>weather</code> and <code>airports</code>.
What is the relationship and how should it appear in the diagram?</p>
</div>
<div class="answer">
<p>The column <code>airports$faa</code> is a foreign key of <code>weather$origin</code>.
The following drawing updates the one in <a href="https://r4ds.had.co.nz/relational-data.html#nycflights13-relational">Section 13.2</a> to include this relation.
The line representing the new relation between <code>weather</code> and <code>airports</code> is colored black.
The lines representing the old relations are gray and thinner.</p>
<p><img src="diagrams/nycflights.png" style="display: block; margin: auto;"></p>
</div>
</div>
<div id="exercise-13.2.3" class="section level3 unnumbered exercise" data-number="13.2.3">
<h3>Exercise 13.2.3<a href="#exercise-13.2.3" class="anchor section-link" aria-hidden="true"><i class="fa fa-link" aria-hidden="true"></i></a>
</h3>
<div class="question">
<p>Weather only contains information for the origin (NYC) airports.
If it contained weather records for all airports in the USA, what additional relation would it define with <code>flights</code>?</p>
</div>
<div class="answer">
<p>If the weather was included for all airports in the US, then it would provide the weather for the destination of each flight.
The <code>weather</code> data frame columns (<code>year</code>, <code>month</code>, <code>day</code>, <code>hour</code>, <code>origin</code>) are a foreign key for the <code>flights</code> data frame columns (<code>year</code>, <code>month</code>, <code>day</code>, <code>hour</code>, <code>dest</code>).
This would provide information about the weather at the destination airport at the time of the flight take off, unless the arrival date-time were calculated.</p>
<p>So why was this not a relationship prior to adding additional rows to the <code>weather</code> table?
In a foreign key relationship, the collection of columns in the child table
must refer to a unique collection of columns in the parent table.
When the <code>weather</code> table only contained New York airports,
there were many values of (<code>year</code>, <code>month</code>, <code>day</code>, <code>hour</code>, <code>dest</code>) in <code>flights</code> that
did not appear in the <code>weather</code> table.
Therefore, it was not a foreign key. It was only after
all combinations of year, month, day, hour, and airports that are defined in <code>flights</code>
were added to the <code>weather</code> table that there existed this relation between these tables.</p>
</div>
</div>
<div id="exercise-13.2.4" class="section level3 unnumbered exercise" data-number="13.2.4">
<h3>Exercise 13.2.4<a href="#exercise-13.2.4" class="anchor section-link" aria-hidden="true"><i class="fa fa-link" aria-hidden="true"></i></a>
</h3>
<div class="question">
<p>We know that some days of the year are “special”, and fewer people than usual fly on them.
How might you represent that data as a data frame?
What would be the primary keys of that table?
How would it connect to the existing tables?</p>
</div>
<div class="answer">
<p>I would add a table of special dates, similar to the following table.</p>
<div class="sourceCode" id="cb393"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb393-1" data-line-number="1">special_days &lt;-<span class="st"> </span><span class="kw">tribble</span>(</a>
<a class="sourceLine" id="cb393-2" data-line-number="2">  <span class="op">~</span>year, <span class="op">~</span>month, <span class="op">~</span>day, <span class="op">~</span>holiday,</a>
<a class="sourceLine" id="cb393-3" data-line-number="3">  <span class="dv">2013</span>, <span class="dv">01</span>, <span class="dv">01</span>, <span class="st">"New Years Day"</span>,</a>
<a class="sourceLine" id="cb393-4" data-line-number="4">  <span class="dv">2013</span>, <span class="dv">07</span>, <span class="dv">04</span>, <span class="st">"Independence Day"</span>,</a>
<a class="sourceLine" id="cb393-5" data-line-number="5">  <span class="dv">2013</span>, <span class="dv">11</span>, <span class="dv">29</span>, <span class="st">"Thanksgiving Day"</span>,</a>
<a class="sourceLine" id="cb393-6" data-line-number="6">  <span class="dv">2013</span>, <span class="dv">12</span>, <span class="dv">25</span>, <span class="st">"Christmas Day"</span></a>
<a class="sourceLine" id="cb393-7" data-line-number="7">)</a></code></pre></div>
<p>The primary key of the table would be the (<code>year</code>, <code>month</code>, <code>day</code>) columns.
The (<code>year</code>, <code>month</code>, <code>day</code>) columns could be used to join <code>special_days</code> with other tables.</p>
</div>
</div>
</div>
<div id="keys" class="section level2 r4ds-section">
<h2>
<a href="#keys" class="anchor section-link" aria-hidden="true"><i class="fa fa-link" aria-hidden="true"></i></a><span class="header-section-number">13.3</span> Keys<a href="https://r4ds.had.co.nz/relational-data.html#keys" class="r4ds-section-link section-link" aria-hidden="true"><i class="fa fa-external-link" aria-hidden="true"></i></a>
</h2>
<div id="exercise-13.3.1" class="section level3 unnumbered exercise" data-number="13.3.1">
<h3>Exercise 13.3.1<a href="#exercise-13.3.1" class="anchor section-link" aria-hidden="true"><i class="fa fa-link" aria-hidden="true"></i></a>
</h3>
<div class="question">
<p>Add a surrogate key to flights.</p>
</div>
<div class="answer">
<p>I add the column <code>flight_id</code> as a surrogate key.
I sort the data prior to making the key, even though it is not strictly necessary, so the order of the rows has some meaning.</p>
<div class="sourceCode" id="cb394"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb394-1" data-line-number="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb394-2" data-line-number="2"><span class="st">  </span><span class="kw">arrange</span>(year, month, day, sched_dep_time, carrier, flight) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb394-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">flight_id =</span> <span class="kw">row_number</span>()) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb394-4" data-line-number="4"><span class="st">  </span><span class="kw">glimpse</span>()</a>
<a class="sourceLine" id="cb394-5" data-line-number="5"><span class="co">#&gt; Rows: 336,776</span></a>
<a class="sourceLine" id="cb394-6" data-line-number="6"><span class="co">#&gt; Columns: 20</span></a>
<a class="sourceLine" id="cb394-7" data-line-number="7"><span class="co">#&gt; $ year           &lt;int&gt; 2013, 2013, 2013, 2013, 2013, 2013, 2013, 2013, 2013, …</span></a>
<a class="sourceLine" id="cb394-8" data-line-number="8"><span class="co">#&gt; $ month          &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, …</span></a>
<a class="sourceLine" id="cb394-9" data-line-number="9"><span class="co">#&gt; $ day            &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, …</span></a>
<a class="sourceLine" id="cb394-10" data-line-number="10"><span class="co">#&gt; $ dep_time       &lt;int&gt; 517, 533, 542, 544, 554, 559, 558, 559, 558, 558, 557,…</span></a>
<a class="sourceLine" id="cb394-11" data-line-number="11"><span class="co">#&gt; $ sched_dep_time &lt;int&gt; 515, 529, 540, 545, 558, 559, 600, 600, 600, 600, 600,…</span></a>
<a class="sourceLine" id="cb394-12" data-line-number="12"><span class="co">#&gt; $ dep_delay      &lt;dbl&gt; 2, 4, 2, -1, -4, 0, -2, -1, -2, -2, -3, NA, 1, 0, -5, …</span></a>
<a class="sourceLine" id="cb394-13" data-line-number="13"><span class="co">#&gt; $ arr_time       &lt;int&gt; 830, 850, 923, 1004, 740, 702, 753, 941, 849, 853, 838…</span></a>
<a class="sourceLine" id="cb394-14" data-line-number="14"><span class="co">#&gt; $ sched_arr_time &lt;int&gt; 819, 830, 850, 1022, 728, 706, 745, 910, 851, 856, 846…</span></a>
<a class="sourceLine" id="cb394-15" data-line-number="15"><span class="co">#&gt; $ arr_delay      &lt;dbl&gt; 11, 20, 33, -18, 12, -4, 8, 31, -2, -3, -8, NA, -6, -7…</span></a>
<a class="sourceLine" id="cb394-16" data-line-number="16"><span class="co">#&gt; $ carrier        &lt;chr&gt; "UA", "UA", "AA", "B6", "UA", "B6", "AA", "AA", "B6", …</span></a>
<a class="sourceLine" id="cb394-17" data-line-number="17"><span class="co">#&gt; $ flight         &lt;int&gt; 1545, 1714, 1141, 725, 1696, 1806, 301, 707, 49, 71, 7…</span></a>
<a class="sourceLine" id="cb394-18" data-line-number="18"><span class="co">#&gt; $ tailnum        &lt;chr&gt; "N14228", "N24211", "N619AA", "N804JB", "N39463", "N70…</span></a>
<a class="sourceLine" id="cb394-19" data-line-number="19"><span class="co">#&gt; $ origin         &lt;chr&gt; "EWR", "LGA", "JFK", "JFK", "EWR", "JFK", "LGA", "LGA"…</span></a>
<a class="sourceLine" id="cb394-20" data-line-number="20"><span class="co">#&gt; $ dest           &lt;chr&gt; "IAH", "IAH", "MIA", "BQN", "ORD", "BOS", "ORD", "DFW"…</span></a>
<a class="sourceLine" id="cb394-21" data-line-number="21"><span class="co">#&gt; $ air_time       &lt;dbl&gt; 227, 227, 160, 183, 150, 44, 138, 257, 149, 158, 140, …</span></a>
<a class="sourceLine" id="cb394-22" data-line-number="22"><span class="co">#&gt; $ distance       &lt;dbl&gt; 1400, 1416, 1089, 1576, 719, 187, 733, 1389, 1028, 100…</span></a>
<a class="sourceLine" id="cb394-23" data-line-number="23"><span class="co">#&gt; $ hour           &lt;dbl&gt; 5, 5, 5, 5, 5, 5, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, …</span></a>
<a class="sourceLine" id="cb394-24" data-line-number="24"><span class="co">#&gt; $ minute         &lt;dbl&gt; 15, 29, 40, 45, 58, 59, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, …</span></a>
<a class="sourceLine" id="cb394-25" data-line-number="25"><span class="co">#&gt; $ time_hour      &lt;dttm&gt; 2013-01-01 05:00:00, 2013-01-01 05:00:00, 2013-01-01 …</span></a>
<a class="sourceLine" id="cb394-26" data-line-number="26"><span class="co">#&gt; $ flight_id      &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16,…</span></a></code></pre></div>
</div>
</div>
<div id="exercise-13.3.2" class="section level3 unnumbered exercise" data-number="13.3.2">
<h3>Exercise 13.3.2<a href="#exercise-13.3.2" class="anchor section-link" aria-hidden="true"><i class="fa fa-link" aria-hidden="true"></i></a>
</h3>
<div class="question">
<p>Identify the keys in the following datasets</p>
<ol style="list-style-type: decimal">
<li><code>Lahman::Batting</code></li>
<li><code>babynames::babynames</code></li>
<li><code>nasaweather::atmos</code></li>
<li><code>fueleconomy::vehicles</code></li>
<li><code>ggplot2::diamonds</code></li>
</ol>
<p>(You might need to install some packages and read some documentation.)</p>
</div>
<div class="answer">
<p>The answer to each part follows.</p>
<ol style="list-style-type: decimal">
<li>
<p>The primary key for <code>Lahman::Batting</code> is (<code>playerID</code>, <code>yearID</code>, <code>stint</code>).
The columns (<code>playerID</code>, <code>yearID</code>) are not a primary key because players can play on different teams within the same year.</p>
<div class="sourceCode" id="cb395"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb395-1" data-line-number="1">Lahman<span class="op">::</span>Batting <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb395-2" data-line-number="2"><span class="st">  </span><span class="kw">count</span>(playerID, yearID, stint) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb395-3" data-line-number="3"><span class="st">  </span><span class="kw">filter</span>(n <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb395-4" data-line-number="4"><span class="st">  </span><span class="kw">nrow</span>()</a>
<a class="sourceLine" id="cb395-5" data-line-number="5"><span class="co">#&gt; [1] 0</span></a></code></pre></div>
</li>
<li>
<p>The primary key for <code>babynames::babynames</code> is (<code>year</code>, <code>sex</code>, <code>name</code>).
The columns (<code>year</code>, <code>name</code>) are not a primary key since there are separate counts for each name for each sex, and the same names can be used by more than one sex.</p>
<div class="sourceCode" id="cb396"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb396-1" data-line-number="1">babynames<span class="op">::</span>babynames <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb396-2" data-line-number="2"><span class="st">  </span><span class="kw">count</span>(year, sex, name) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb396-3" data-line-number="3"><span class="st">  </span><span class="kw">filter</span>(n <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb396-4" data-line-number="4"><span class="st">  </span><span class="kw">nrow</span>()</a>
<a class="sourceLine" id="cb396-5" data-line-number="5"><span class="co">#&gt; Using `n` as weighting variable</span></a>
<a class="sourceLine" id="cb396-6" data-line-number="6"><span class="co">#&gt; ℹ Quiet this message with `wt = n` or count rows with `wt = 1`</span></a>
<a class="sourceLine" id="cb396-7" data-line-number="7"><span class="co">#&gt; [1] 1924665</span></a></code></pre></div>
</li>
<li>
<p>The primary key for <code>nasaweather::atmos</code> is (<code>lat</code>, <code>long</code>, <code>year</code>, <code>month</code>).
The primary key represents the location and time that the measurement was taken.</p>
<div class="sourceCode" id="cb397"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb397-1" data-line-number="1">nasaweather<span class="op">::</span>atmos <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb397-2" data-line-number="2"><span class="st">  </span><span class="kw">count</span>(lat, long, year, month) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb397-3" data-line-number="3"><span class="st">  </span><span class="kw">filter</span>(n <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb397-4" data-line-number="4"><span class="st">  </span><span class="kw">nrow</span>()</a>
<a class="sourceLine" id="cb397-5" data-line-number="5"><span class="co">#&gt; [1] 0</span></a></code></pre></div>
</li>
<li>
<p>The column <code>id</code>, the unique EPA identifier of the vehicle, is the primary key for <code>fueleconomy::vehicles</code>.</p>
<div class="sourceCode" id="cb398"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb398-1" data-line-number="1">fueleconomy<span class="op">::</span>vehicles <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb398-2" data-line-number="2"><span class="st">  </span><span class="kw">count</span>(id) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb398-3" data-line-number="3"><span class="st">  </span><span class="kw">filter</span>(n <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb398-4" data-line-number="4"><span class="st">  </span><span class="kw">nrow</span>()</a>
<a class="sourceLine" id="cb398-5" data-line-number="5"><span class="co">#&gt; [1] 0</span></a></code></pre></div>
</li>
<li>
<p>There is no primary key for <code>ggplot2::diamonds</code> since there is no combination of variables that uniquely identifies each observation.
This is implied by the fact that the number of distinct rows in the dataset is less than the total number of rows, meaning that there are some duplicate rows.</p>
<div class="sourceCode" id="cb399"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb399-1" data-line-number="1">ggplot2<span class="op">::</span>diamonds <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb399-2" data-line-number="2"><span class="st">  </span><span class="kw">distinct</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb399-3" data-line-number="3"><span class="st">  </span><span class="kw">nrow</span>()</a>
<a class="sourceLine" id="cb399-4" data-line-number="4"><span class="co">#&gt; [1] 53794</span></a>
<a class="sourceLine" id="cb399-5" data-line-number="5"><span class="kw">nrow</span>(ggplot2<span class="op">::</span>diamonds)</a>
<a class="sourceLine" id="cb399-6" data-line-number="6"><span class="co">#&gt; [1] 53940</span></a></code></pre></div>
<p>If we need a unique identifier for our analysis, we could add a surrogate key.</p>
<div class="sourceCode" id="cb400"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb400-1" data-line-number="1">diamonds &lt;-<span class="st"> </span><span class="kw">mutate</span>(ggplot2<span class="op">::</span>diamonds, <span class="dt">id =</span> <span class="kw">row_number</span>())</a></code></pre></div>
</li>
</ol>
</div>
</div>
<div id="exercise-13.3.3" class="section level3 unnumbered exercise" data-number="13.3.3">
<h3>Exercise 13.3.3<a href="#exercise-13.3.3" class="anchor section-link" aria-hidden="true"><i class="fa fa-link" aria-hidden="true"></i></a>
</h3>
<div class="question">
<p>Draw a diagram illustrating the connections between the <code>Batting</code>, <code>Master</code>, and <code>Salaries</code> tables in the Lahman package.
Draw another diagram that shows the relationship between <code>Master</code>, <code>Managers</code>, <code>AwardsManagers</code>.</p>
<p>How would you characterize the relationship between the <code>Batting</code>, <code>Pitching</code>, and <code>Fielding</code> tables?</p>
</div>
<div class="answer">
<p>For the <code>Batting</code>, <code>Master</code>, and <code>Salaries</code> tables:</p>
<ul>
<li>
<p><code>Master</code></p>
<ul>
<li>Primary key: <code>playerID</code>
</li>
</ul>
</li>
<li>
<p><code>Batting</code></p>
<ul>
<li><p>Primary key: <code>playerID</code>, <code>yearID</code>, <code>stint</code></p></li>
<li>
<p>Foreign keys:</p>
<ul>
<li>
<code>playerID</code> = <code>Master$playerID</code> (many-to-1)</li>
</ul>
</li>
</ul>
</li>
<li>
<p><code>Salaries</code></p>
<ul>
<li><p>Primary key: <code>yearID</code>, <code>teamID</code>, <code>playerID</code></p></li>
<li>
<p>Foreign keys:</p>
<ul>
<li>
<code>playerID</code> = <code>Master$playerID</code> (many-to-1)</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>The columns <code>teamID</code> and <code>lgID</code> are not foreign keys even though they appear in multiple tables (with the same meaning) because they are not primary keys for any of the tables considered in this exercise.
The <code>teamID</code> variable references <code>Teams$teamID</code>, and <code>lgID</code> does not have its own table.</p>
<p><em>R for Data Science</em> uses database schema diagrams to illustrate relations between the tables.
Most flowchart or diagramming software can be used used to create database schema diagrams, as well as some specialized database software.
The diagrams in <em>R for Data Science</em> were created with <a href="https://www.gliffy.com/">OmniGraffle</a>, and their sources can be found in its <a href="https://github.com/hadley/r4ds/tree/master/diagrams">GitHub repository</a>.</p>
<p>The following diagram was created with OmniGraffle in the same style as those
in <em>R for Data Science</em> .
It shows the relations between the <code>Master</code>, <code>Batting</code> and <code>Salaries</code> tables.</p>
<p><img src="diagrams/Lahman1.png" style="display: block; margin: auto;"></p>
<p>Another option to draw database schema diagrams is the R package <a href="https://github.com/bergant/datamodelr">datamodelr</a>, which can programmatically create database schema diagrams.
The following code uses datamodelr to draw a diagram of the relations between the <code>Batting</code>, <code>Master</code>, and <code>Salaries</code> tables.</p>
<div class="sourceCode" id="cb401"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb401-1" data-line-number="1">dm1 &lt;-<span class="st"> </span><span class="kw">dm_from_data_frames</span>(<span class="kw">list</span>(</a>
<a class="sourceLine" id="cb401-2" data-line-number="2">  <span class="dt">Batting =</span> Lahman<span class="op">::</span>Batting,</a>
<a class="sourceLine" id="cb401-3" data-line-number="3">  <span class="dt">Master =</span> Lahman<span class="op">::</span>Master,</a>
<a class="sourceLine" id="cb401-4" data-line-number="4">  <span class="dt">Salaries =</span> Lahman<span class="op">::</span>Salaries</a>
<a class="sourceLine" id="cb401-5" data-line-number="5">)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb401-6" data-line-number="6"><span class="st">  </span><span class="kw">dm_set_key</span>(<span class="st">"Batting"</span>, <span class="kw">c</span>(<span class="st">"playerID"</span>, <span class="st">"yearID"</span>, <span class="st">"stint"</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb401-7" data-line-number="7"><span class="st">  </span><span class="kw">dm_set_key</span>(<span class="st">"Master"</span>, <span class="st">"playerID"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb401-8" data-line-number="8"><span class="st">  </span><span class="kw">dm_set_key</span>(<span class="st">"Salaries"</span>, <span class="kw">c</span>(<span class="st">"yearID"</span>, <span class="st">"teamID"</span>, <span class="st">"playerID"</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb401-9" data-line-number="9"><span class="st">  </span><span class="kw">dm_add_references</span>(</a>
<a class="sourceLine" id="cb401-10" data-line-number="10">    Batting<span class="op">$</span>playerID <span class="op">==</span><span class="st"> </span>Master<span class="op">$</span>playerID,</a>
<a class="sourceLine" id="cb401-11" data-line-number="11">    Salaries<span class="op">$</span>playerID <span class="op">==</span><span class="st"> </span>Master<span class="op">$</span>playerID</a>
<a class="sourceLine" id="cb401-12" data-line-number="12">  )</a>
<a class="sourceLine" id="cb401-13" data-line-number="13"></a>
<a class="sourceLine" id="cb401-14" data-line-number="14"><span class="kw">dm_create_graph</span>(dm1, <span class="dt">rankdir =</span> <span class="st">"LR"</span>, <span class="dt">columnArrows =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb401-15" data-line-number="15"><span class="st">  </span><span class="kw">dm_render_graph</span>()</a></code></pre></div>
<div id="htmlwidget-ac96cb3ee4656e2e9ec3" style="width:70%;height:415.296px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-ac96cb3ee4656e2e9ec3">{"x":{"diagram":"#data_model\ndigraph {\ngraph [rankdir=LR tooltip=\"Data Model\" ]\n\nnode [margin=0 fontcolor = \"#444444\" ]\n\nedge [color = \"#555555\", arrowsize = 1, ]\n\n\n  \"Batting\" [label = <<TABLE ALIGN=\"LEFT\" BORDER=\"1\" CELLBORDER=\"0\" CELLSPACING=\"0\" COLOR=\"#555555\">\n    <TR>\n      <TD COLSPAN=\"1\" BGCOLOR=\"#EFEBDD\" BORDER=\"0\"><FONT COLOR=\"#000000\">Batting<\/FONT>\n<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\" PORT=\"playerID\"><U>playerID<\/U><\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\" PORT=\"yearID\"><U>yearID<\/U><\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\" PORT=\"stint\"><U>stint<\/U><\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\">teamID<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\">lgID<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\">G<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\">AB<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\">R<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\">H<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\">X2B<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\">X3B<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\">HR<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\">RBI<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\">SB<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\">CS<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\">BB<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\">SO<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\">IBB<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\">HBP<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\">SH<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\">SF<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\">GIDP<\/TD>\n    <\/TR>\n  <\/TABLE>>, shape = \"plaintext\"] \n\n  \"Master\" [label = <<TABLE ALIGN=\"LEFT\" BORDER=\"1\" CELLBORDER=\"0\" CELLSPACING=\"0\" COLOR=\"#555555\">\n    <TR>\n      <TD COLSPAN=\"1\" BGCOLOR=\"#EFEBDD\" BORDER=\"0\"><FONT COLOR=\"#000000\">Master<\/FONT>\n<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\" PORT=\"playerID\"><U>playerID<\/U><\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\">birthYear<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\">birthMonth<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\">birthDay<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\">birthCountry<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\">birthState<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\">birthCity<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\">deathYear<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\">deathMonth<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\">deathDay<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\">deathCountry<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\">deathState<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\">deathCity<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\">nameFirst<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\">nameLast<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\">nameGiven<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\">weight<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\">height<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\">bats<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\">throws<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\">debut<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\">finalGame<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\">retroID<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\">bbrefID<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\">deathDate<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\">birthDate<\/TD>\n    <\/TR>\n  <\/TABLE>>, shape = \"plaintext\"] \n\n  \"Salaries\" [label = <<TABLE ALIGN=\"LEFT\" BORDER=\"1\" CELLBORDER=\"0\" CELLSPACING=\"0\" COLOR=\"#555555\">\n    <TR>\n      <TD COLSPAN=\"1\" BGCOLOR=\"#EFEBDD\" BORDER=\"0\"><FONT COLOR=\"#000000\">Salaries<\/FONT>\n<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\" PORT=\"yearID\"><U>yearID<\/U><\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\" PORT=\"teamID\"><U>teamID<\/U><\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\">lgID<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\" PORT=\"playerID\"><U>playerID<\/U><\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\">salary<\/TD>\n    <\/TR>\n  <\/TABLE>>, shape = \"plaintext\"] \n\n\"Batting\":\"playerID\"->\"Master\":\"playerID\"\n\"Salaries\":\"playerID\"->\"Master\":\"playerID\"\n}","config":{"engine":null,"options":null}},"evals":[],"jsHooks":[]}</script><p>For the <code>Master</code>, <code>Manager</code>, and <code>AwardsManagers</code> tables:</p>
<ul>
<li>
<p><code>Master</code></p>
<ul>
<li>Primary key: <code>playerID</code>
</li>
</ul>
</li>
<li>
<p><code>Managers</code></p>
<ul>
<li><p>Primary key: <code>yearID</code>, <code>teamID</code>, <code>inseason</code></p></li>
<li>
<p>Foreign keys:</p>
<ul>
<li>
<code>playerID</code> references <code>Master$playerID</code> (many-to-1)</li>
</ul>
</li>
</ul>
</li>
<li>
<p><code>AwardsManagers</code>:</p>
<ul>
<li><p>Primary key: <code>playerID</code>, <code>awardID</code>, <code>yearID</code></p></li>
<li>
<p>Foreign keys:</p>
<ul>
<li>
<code>playerID</code> references <code>Master$playerID</code> (many-to-1)</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>For <code>AwardsManagers</code>, the columns (<code>awardID</code>, <code>yearID</code>, <code>lgID</code>) are not a primary
key because there can be, and have been ties, as indicated by the <code>tie</code> variable.</p>
<p>The relations between the <code>Master</code>, <code>Managers</code>, and <code>AwardsManagers</code> tables
are shown in the following two diagrams: the first created manually with OmniGraffle,
and the second programmatically in R with the datamodelr package.</p>
<p><img src="diagrams/Lahman2.png" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb402"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb402-1" data-line-number="1">dm2 &lt;-<span class="st"> </span><span class="kw">dm_from_data_frames</span>(<span class="kw">list</span>(</a>
<a class="sourceLine" id="cb402-2" data-line-number="2">  <span class="dt">Master =</span> Lahman<span class="op">::</span>Master,</a>
<a class="sourceLine" id="cb402-3" data-line-number="3">  <span class="dt">Managers =</span> Lahman<span class="op">::</span>Managers,</a>
<a class="sourceLine" id="cb402-4" data-line-number="4">  <span class="dt">AwardsManagers =</span> Lahman<span class="op">::</span>AwardsManagers</a>
<a class="sourceLine" id="cb402-5" data-line-number="5">)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb402-6" data-line-number="6"><span class="st">  </span><span class="kw">dm_set_key</span>(<span class="st">"Master"</span>, <span class="st">"playerID"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb402-7" data-line-number="7"><span class="st">  </span><span class="kw">dm_set_key</span>(<span class="st">"Managers"</span>, <span class="kw">c</span>(<span class="st">"yearID"</span>, <span class="st">"teamID"</span>, <span class="st">"inseason"</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb402-8" data-line-number="8"><span class="st">  </span><span class="kw">dm_set_key</span>(<span class="st">"AwardsManagers"</span>, <span class="kw">c</span>(<span class="st">"playerID"</span>, <span class="st">"awardID"</span>, <span class="st">"yearID"</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb402-9" data-line-number="9"><span class="st">  </span><span class="kw">dm_add_references</span>(</a>
<a class="sourceLine" id="cb402-10" data-line-number="10">    Managers<span class="op">$</span>playerID <span class="op">==</span><span class="st"> </span>Master<span class="op">$</span>playerID,</a>
<a class="sourceLine" id="cb402-11" data-line-number="11">    AwardsManagers<span class="op">$</span>playerID <span class="op">==</span><span class="st"> </span>Master<span class="op">$</span>playerID</a>
<a class="sourceLine" id="cb402-12" data-line-number="12">  )</a>
<a class="sourceLine" id="cb402-13" data-line-number="13"></a>
<a class="sourceLine" id="cb402-14" data-line-number="14"><span class="kw">dm_create_graph</span>(dm2, <span class="dt">rankdir =</span> <span class="st">"LR"</span>, <span class="dt">columnArrows =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb402-15" data-line-number="15"><span class="st">  </span><span class="kw">dm_render_graph</span>()</a></code></pre></div>
<div id="htmlwidget-e5c8c404fe174e4c81bd" style="width:70%;height:415.296px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-e5c8c404fe174e4c81bd">{"x":{"diagram":"#data_model\ndigraph {\ngraph [rankdir=LR tooltip=\"Data Model\" ]\n\nnode [margin=0 fontcolor = \"#444444\" ]\n\nedge [color = \"#555555\", arrowsize = 1, ]\n\n\n  \"AwardsManagers\" [label = <<TABLE ALIGN=\"LEFT\" BORDER=\"1\" CELLBORDER=\"0\" CELLSPACING=\"0\" COLOR=\"#555555\">\n    <TR>\n      <TD COLSPAN=\"1\" BGCOLOR=\"#EFEBDD\" BORDER=\"0\"><FONT COLOR=\"#000000\">AwardsManagers<\/FONT>\n<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\" PORT=\"playerID\"><U>playerID<\/U><\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\" PORT=\"awardID\"><U>awardID<\/U><\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\" PORT=\"yearID\"><U>yearID<\/U><\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\">lgID<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\">tie<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\">notes<\/TD>\n    <\/TR>\n  <\/TABLE>>, shape = \"plaintext\"] \n\n  \"Managers\" [label = <<TABLE ALIGN=\"LEFT\" BORDER=\"1\" CELLBORDER=\"0\" CELLSPACING=\"0\" COLOR=\"#555555\">\n    <TR>\n      <TD COLSPAN=\"1\" BGCOLOR=\"#EFEBDD\" BORDER=\"0\"><FONT COLOR=\"#000000\">Managers<\/FONT>\n<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\" PORT=\"playerID\">playerID<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\" PORT=\"yearID\"><U>yearID<\/U><\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\" PORT=\"teamID\"><U>teamID<\/U><\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\">lgID<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\" PORT=\"inseason\"><U>inseason<\/U><\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\">G<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\">W<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\">L<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\">rank<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\">plyrMgr<\/TD>\n    <\/TR>\n  <\/TABLE>>, shape = \"plaintext\"] \n\n  \"Master\" [label = <<TABLE ALIGN=\"LEFT\" BORDER=\"1\" CELLBORDER=\"0\" CELLSPACING=\"0\" COLOR=\"#555555\">\n    <TR>\n      <TD COLSPAN=\"1\" BGCOLOR=\"#EFEBDD\" BORDER=\"0\"><FONT COLOR=\"#000000\">Master<\/FONT>\n<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\" PORT=\"playerID\"><U>playerID<\/U><\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\">birthYear<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\">birthMonth<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\">birthDay<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\">birthCountry<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\">birthState<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\">birthCity<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\">deathYear<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\">deathMonth<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\">deathDay<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\">deathCountry<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\">deathState<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\">deathCity<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\">nameFirst<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\">nameLast<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\">nameGiven<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\">weight<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\">height<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\">bats<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\">throws<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\">debut<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\">finalGame<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\">retroID<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\">bbrefID<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\">deathDate<\/TD>\n    <\/TR>\n    <TR>\n      <TD ALIGN=\"LEFT\" BGCOLOR=\"#FFFFFF\">birthDate<\/TD>\n    <\/TR>\n  <\/TABLE>>, shape = \"plaintext\"] \n\n\"Managers\":\"playerID\"->\"Master\":\"playerID\"\n\"AwardsManagers\":\"playerID\"->\"Master\":\"playerID\"\n}","config":{"engine":null,"options":null}},"evals":[],"jsHooks":[]}</script><p>The primary keys of <code>Batting</code>, <code>Pitching</code>, and <code>Fielding</code> are the following:</p>
<ul>
<li>
<code>Batting</code>: (<code>playerID</code>, <code>yearID</code>, <code>stint</code>)</li>
<li>
<code>Pitching</code>: (<code>playerID</code>, <code>yearID</code>, <code>stint</code>)</li>
<li>
<code>Fielding</code>: (<code>playerID</code>, <code>yearID</code>, <code>stint</code>, <code>POS</code>).</li>
</ul>
<p>While <code>Batting</code> and <code>Pitching</code> has one row per player, year, stint, the <code>Fielding</code>
table has additional rows for each position (<code>POS</code>) a player played within a stint.</p>
<p>Since <code>Batting</code>, <code>Pitching</code>, and <code>Fielding</code> all share the <code>playerID</code>, <code>yearID</code>, and <code>stint</code>
we would expect some foreign key relations between these tables.
The columns (<code>playerID</code>, <code>yearID</code>, <code>stint</code>) in <code>Pitching</code> are a foreign key which
references the same columns in <code>Batting</code>. We can check this by checking that
all observed combinations of values of these columns appearing in <code>Pitching</code>
also appear in <code>Batting</code>. To do this I use an anti-join, which is discussed
in the section <a href="https://r4ds.had.co.nz/relational-data.html#filtering-joins">Filtering Joins</a>.</p>
<div class="sourceCode" id="cb403"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb403-1" data-line-number="1"><span class="kw">nrow</span>(<span class="kw">anti_join</span>(Lahman<span class="op">::</span>Pitching, Lahman<span class="op">::</span>Batting,</a>
<a class="sourceLine" id="cb403-2" data-line-number="2">  <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">"playerID"</span>, <span class="st">"yearID"</span>, <span class="st">"stint"</span>)</a>
<a class="sourceLine" id="cb403-3" data-line-number="3">))</a>
<a class="sourceLine" id="cb403-4" data-line-number="4"><span class="co">#&gt; [1] 0</span></a></code></pre></div>
<p>Similarly, the columns (<code>playerID</code>, <code>yearID</code>, <code>stint</code>) in <code>Fielding</code> are a foreign key which references the same columns in <code>Batting</code>.</p>
<div class="sourceCode" id="cb404"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb404-1" data-line-number="1"><span class="kw">nrow</span>(<span class="kw">anti_join</span>(Lahman<span class="op">::</span>Fielding, Lahman<span class="op">::</span>Batting,</a>
<a class="sourceLine" id="cb404-2" data-line-number="2">  <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">"playerID"</span>, <span class="st">"yearID"</span>, <span class="st">"stint"</span>)</a>
<a class="sourceLine" id="cb404-3" data-line-number="3">))</a>
<a class="sourceLine" id="cb404-4" data-line-number="4"><span class="co">#&gt; [1] 0</span></a></code></pre></div>
<p>The following diagram shows the relations between the <code>Batting</code>, <code>Pitching</code>, and
<code>Fielding</code> tables.</p>
<p><img src="diagrams/Lahman3.png" style="display: block; margin: auto;"></p>
</div>
</div>
</div>
<div id="mutating-joins" class="section level2 r4ds-section">
<h2>
<a href="#mutating-joins" class="anchor section-link" aria-hidden="true"><i class="fa fa-link" aria-hidden="true"></i></a><span class="header-section-number">13.4</span> Mutating joins<a href="https://r4ds.had.co.nz/relational-data.html#mutating-joins" class="r4ds-section-link section-link" aria-hidden="true"><i class="fa fa-external-link" aria-hidden="true"></i></a>
</h2>
<div class="sourceCode" id="cb405"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb405-1" data-line-number="1">flights2 &lt;-<span class="st"> </span>flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb405-2" data-line-number="2"><span class="st">  </span><span class="kw">select</span>(year<span class="op">:</span>day, hour, origin, dest, tailnum, carrier)</a></code></pre></div>
<div id="exercise-13.4.1" class="section level3 unnumbered exercise" data-number="13.4.1">
<h3>Exercise 13.4.1<a href="#exercise-13.4.1" class="anchor section-link" aria-hidden="true"><i class="fa fa-link" aria-hidden="true"></i></a>
</h3>
<div class="question">
<p>Compute the average delay by destination, then join on the <code>airports</code> data frame so you can show the spatial distribution of delays. Here’s an easy way to draw a map of the United States:</p>
<div class="sourceCode" id="cb406"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb406-1" data-line-number="1">airports <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb406-2" data-line-number="2"><span class="st">  </span><span class="kw">semi_join</span>(flights, <span class="kw">c</span>(<span class="st">"faa"</span> =<span class="st"> "dest"</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb406-3" data-line-number="3"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(lon, lat)) <span class="op">+</span></a>
<a class="sourceLine" id="cb406-4" data-line-number="4"><span class="st">  </span><span class="kw">borders</span>(<span class="st">"state"</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb406-5" data-line-number="5"><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb406-6" data-line-number="6"><span class="st">  </span><span class="kw">coord_quickmap</span>()</a></code></pre></div>
<p><img src="relational-data_files/figure-html/unnamed-chunk-20-1.png" width="70%" style="display: block; margin: auto;"></p>
<p>(Don’t worry if you don’t understand what <code>semi_join()</code> does — you’ll learn about it next.)</p>
<p>You might want to use the size or color of the points to display the average delay for each airport.</p>
</div>
<div class="answer">
<div class="sourceCode" id="cb407"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb407-1" data-line-number="1">avg_dest_delays &lt;-</a>
<a class="sourceLine" id="cb407-2" data-line-number="2"><span class="st">  </span>flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb407-3" data-line-number="3"><span class="st">  </span><span class="kw">group_by</span>(dest) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb407-4" data-line-number="4"><span class="st">  </span><span class="co"># arrival delay NA's are cancelled flights</span></a>
<a class="sourceLine" id="cb407-5" data-line-number="5"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">delay =</span> <span class="kw">mean</span>(arr_delay, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb407-6" data-line-number="6"><span class="st">  </span><span class="kw">inner_join</span>(airports, <span class="dt">by =</span> <span class="kw">c</span>(<span class="dt">dest =</span> <span class="st">"faa"</span>))</a>
<a class="sourceLine" id="cb407-7" data-line-number="7"><span class="co">#&gt; `summarise()` ungrouping output (override with `.groups` argument)</span></a></code></pre></div>
<div class="sourceCode" id="cb408"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb408-1" data-line-number="1">avg_dest_delays <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb408-2" data-line-number="2"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(lon, lat, <span class="dt">colour =</span> delay)) <span class="op">+</span></a>
<a class="sourceLine" id="cb408-3" data-line-number="3"><span class="st">  </span><span class="kw">borders</span>(<span class="st">"state"</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb408-4" data-line-number="4"><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb408-5" data-line-number="5"><span class="st">  </span><span class="kw">coord_quickmap</span>()</a></code></pre></div>
<p><img src="relational-data_files/figure-html/unnamed-chunk-22-1.png" width="70%" style="display: block; margin: auto;"></p>
</div>
</div>
<div id="exercise-13.4.2" class="section level3 unnumbered exercise" data-number="13.4.2">
<h3>Exercise 13.4.2<a href="#exercise-13.4.2" class="anchor section-link" aria-hidden="true"><i class="fa fa-link" aria-hidden="true"></i></a>
</h3>
<div class="question">
<p>Add the location of the origin and destination (i.e. the <code>lat</code> and <code>lon</code>) to <code>flights</code>.</p>
</div>
<div class="answer">
<p>You can perform one join after another. If duplicate variables are found, by default, dplyr will distinguish the two by adding <code>.x</code>, and <code>.y</code> to the ends of the variable names to solve naming conflicts.</p>
<div class="sourceCode" id="cb409"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb409-1" data-line-number="1">airport_locations &lt;-<span class="st"> </span>airports <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb409-2" data-line-number="2"><span class="st">  </span><span class="kw">select</span>(faa, lat, lon)</a>
<a class="sourceLine" id="cb409-3" data-line-number="3"></a>
<a class="sourceLine" id="cb409-4" data-line-number="4">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb409-5" data-line-number="5"><span class="st">  </span><span class="kw">select</span>(year<span class="op">:</span>day, hour, origin, dest) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb409-6" data-line-number="6"><span class="st">  </span><span class="kw">left_join</span>(</a>
<a class="sourceLine" id="cb409-7" data-line-number="7">    airport_locations,</a>
<a class="sourceLine" id="cb409-8" data-line-number="8">    <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">"origin"</span> =<span class="st"> "faa"</span>)</a>
<a class="sourceLine" id="cb409-9" data-line-number="9">  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb409-10" data-line-number="10"><span class="st">  </span><span class="kw">left_join</span>(</a>
<a class="sourceLine" id="cb409-11" data-line-number="11">    airport_locations,</a>
<a class="sourceLine" id="cb409-12" data-line-number="12">    <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">"dest"</span> =<span class="st"> "faa"</span>)</a>
<a class="sourceLine" id="cb409-13" data-line-number="13">  )</a>
<a class="sourceLine" id="cb409-14" data-line-number="14"><span class="co">#&gt; # A tibble: 336,776 x 10</span></a>
<a class="sourceLine" id="cb409-15" data-line-number="15"><span class="co">#&gt;    year month   day  hour origin dest  lat.x lon.x lat.y lon.y</span></a>
<a class="sourceLine" id="cb409-16" data-line-number="16"><span class="co">#&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb409-17" data-line-number="17"><span class="co">#&gt; 1  2013     1     1     5 EWR    IAH    40.7 -74.2  30.0 -95.3</span></a>
<a class="sourceLine" id="cb409-18" data-line-number="18"><span class="co">#&gt; 2  2013     1     1     5 LGA    IAH    40.8 -73.9  30.0 -95.3</span></a>
<a class="sourceLine" id="cb409-19" data-line-number="19"><span class="co">#&gt; 3  2013     1     1     5 JFK    MIA    40.6 -73.8  25.8 -80.3</span></a>
<a class="sourceLine" id="cb409-20" data-line-number="20"><span class="co">#&gt; 4  2013     1     1     5 JFK    BQN    40.6 -73.8  NA    NA  </span></a>
<a class="sourceLine" id="cb409-21" data-line-number="21"><span class="co">#&gt; 5  2013     1     1     6 LGA    ATL    40.8 -73.9  33.6 -84.4</span></a>
<a class="sourceLine" id="cb409-22" data-line-number="22"><span class="co">#&gt; 6  2013     1     1     5 EWR    ORD    40.7 -74.2  42.0 -87.9</span></a>
<a class="sourceLine" id="cb409-23" data-line-number="23"><span class="co">#&gt; # … with 336,770 more rows</span></a></code></pre></div>
<p>The <code>suffix</code> argument overrides this default behavior.
Since is always good practice to have clear variable names, I will use the
suffixes <code>"_dest"</code> and <code>"_origin</code>" to specify whether the column refers to
the destination or origin airport.</p>
<div class="sourceCode" id="cb410"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb410-1" data-line-number="1">airport_locations &lt;-<span class="st"> </span>airports <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb410-2" data-line-number="2"><span class="st">  </span><span class="kw">select</span>(faa, lat, lon)</a>
<a class="sourceLine" id="cb410-3" data-line-number="3"></a>
<a class="sourceLine" id="cb410-4" data-line-number="4">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb410-5" data-line-number="5"><span class="st">  </span><span class="kw">select</span>(year<span class="op">:</span>day, hour, origin, dest) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb410-6" data-line-number="6"><span class="st">  </span><span class="kw">left_join</span>(</a>
<a class="sourceLine" id="cb410-7" data-line-number="7">    airport_locations,</a>
<a class="sourceLine" id="cb410-8" data-line-number="8">    <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">"origin"</span> =<span class="st"> "faa"</span>)</a>
<a class="sourceLine" id="cb410-9" data-line-number="9">  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb410-10" data-line-number="10"><span class="st">  </span><span class="kw">left_join</span>(</a>
<a class="sourceLine" id="cb410-11" data-line-number="11">    airport_locations,</a>
<a class="sourceLine" id="cb410-12" data-line-number="12">    <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">"dest"</span> =<span class="st"> "faa"</span>),</a>
<a class="sourceLine" id="cb410-13" data-line-number="13">    <span class="dt">suffix =</span> <span class="kw">c</span>(<span class="st">"_origin"</span>, <span class="st">"_dest"</span>)</a>
<a class="sourceLine" id="cb410-14" data-line-number="14">    <span class="co"># existing lat and lon variables in tibble gain the _origin suffix</span></a>
<a class="sourceLine" id="cb410-15" data-line-number="15">    <span class="co"># new lat and lon variables are given _dest suffix</span></a>
<a class="sourceLine" id="cb410-16" data-line-number="16">  )</a>
<a class="sourceLine" id="cb410-17" data-line-number="17"><span class="co">#&gt; # A tibble: 336,776 x 10</span></a>
<a class="sourceLine" id="cb410-18" data-line-number="18"><span class="co">#&gt;    year month   day  hour origin dest  lat_origin lon_origin lat_dest lon_dest</span></a>
<a class="sourceLine" id="cb410-19" data-line-number="19"><span class="co">#&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;      &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb410-20" data-line-number="20"><span class="co">#&gt; 1  2013     1     1     5 EWR    IAH         40.7      -74.2     30.0    -95.3</span></a>
<a class="sourceLine" id="cb410-21" data-line-number="21"><span class="co">#&gt; 2  2013     1     1     5 LGA    IAH         40.8      -73.9     30.0    -95.3</span></a>
<a class="sourceLine" id="cb410-22" data-line-number="22"><span class="co">#&gt; 3  2013     1     1     5 JFK    MIA         40.6      -73.8     25.8    -80.3</span></a>
<a class="sourceLine" id="cb410-23" data-line-number="23"><span class="co">#&gt; 4  2013     1     1     5 JFK    BQN         40.6      -73.8     NA       NA  </span></a>
<a class="sourceLine" id="cb410-24" data-line-number="24"><span class="co">#&gt; 5  2013     1     1     6 LGA    ATL         40.8      -73.9     33.6    -84.4</span></a>
<a class="sourceLine" id="cb410-25" data-line-number="25"><span class="co">#&gt; 6  2013     1     1     5 EWR    ORD         40.7      -74.2     42.0    -87.9</span></a>
<a class="sourceLine" id="cb410-26" data-line-number="26"><span class="co">#&gt; # … with 336,770 more rows</span></a></code></pre></div>
</div>
</div>
<div id="exercise-13.4.3" class="section level3 unnumbered exercise" data-number="13.4.3">
<h3>Exercise 13.4.3<a href="#exercise-13.4.3" class="anchor section-link" aria-hidden="true"><i class="fa fa-link" aria-hidden="true"></i></a>
</h3>
<div class="question">
<p>Is there a relationship between the age of a plane and its delays?</p>
</div>
<div class="answer">
<p>The question does not specify whether the relationship is with departure delay
or arrival delay.
I will look at both.</p>
<p>To compare the age of the plane to flights delay, I merge <code>flights</code> with the <code>planes</code>, which contains a variable <code>plane_year</code>, with the year in which the plane was built.
To look at the relationship between plane age and departure delay, I will calculate the average arrival and departure delay for each age of a flight.
Since there are few planes older than 25 years, so I truncate <code>age</code> at 25 years.</p>
<div class="sourceCode" id="cb411"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb411-1" data-line-number="1">plane_cohorts &lt;-<span class="st"> </span><span class="kw">inner_join</span>(flights,</a>
<a class="sourceLine" id="cb411-2" data-line-number="2">  <span class="kw">select</span>(planes, tailnum, <span class="dt">plane_year =</span> year),</a>
<a class="sourceLine" id="cb411-3" data-line-number="3">  <span class="dt">by =</span> <span class="st">"tailnum"</span></a>
<a class="sourceLine" id="cb411-4" data-line-number="4">) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb411-5" data-line-number="5"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">age =</span> year <span class="op">-</span><span class="st"> </span>plane_year) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb411-6" data-line-number="6"><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(age)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb411-7" data-line-number="7"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">age =</span> <span class="kw">if_else</span>(age <span class="op">&gt;</span><span class="st"> </span><span class="dv">25</span>, 25L, age)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb411-8" data-line-number="8"><span class="st">  </span><span class="kw">group_by</span>(age) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb411-9" data-line-number="9"><span class="st">  </span><span class="kw">summarise</span>(</a>
<a class="sourceLine" id="cb411-10" data-line-number="10">    <span class="dt">dep_delay_mean =</span> <span class="kw">mean</span>(dep_delay, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),</a>
<a class="sourceLine" id="cb411-11" data-line-number="11">    <span class="dt">dep_delay_sd =</span> <span class="kw">sd</span>(dep_delay, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),</a>
<a class="sourceLine" id="cb411-12" data-line-number="12">    <span class="dt">arr_delay_mean =</span> <span class="kw">mean</span>(arr_delay, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),</a>
<a class="sourceLine" id="cb411-13" data-line-number="13">    <span class="dt">arr_delay_sd =</span> <span class="kw">sd</span>(arr_delay, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),</a>
<a class="sourceLine" id="cb411-14" data-line-number="14">    <span class="dt">n_arr_delay =</span> <span class="kw">sum</span>(<span class="op">!</span><span class="kw">is.na</span>(arr_delay)),</a>
<a class="sourceLine" id="cb411-15" data-line-number="15">    <span class="dt">n_dep_delay =</span> <span class="kw">sum</span>(<span class="op">!</span><span class="kw">is.na</span>(dep_delay))</a>
<a class="sourceLine" id="cb411-16" data-line-number="16">  )</a>
<a class="sourceLine" id="cb411-17" data-line-number="17"><span class="co">#&gt; `summarise()` ungrouping output (override with `.groups` argument)</span></a></code></pre></div>
<p>I will look for a relationship between departure delay and age by plotting age against the average departure delay.
The average departure delay is increasing for planes with ages up until 10 years. After that the departure delay decreases or levels off.
The decrease in departure delay could be because older planes with many mechanical issues are removed from service or because air lines schedule these planes with enough time so that mechanical issues do not delay them.</p>
<div class="sourceCode" id="cb412"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb412-1" data-line-number="1"><span class="kw">ggplot</span>(plane_cohorts, <span class="kw">aes</span>(<span class="dt">x =</span> age, <span class="dt">y =</span> dep_delay_mean)) <span class="op">+</span></a>
<a class="sourceLine" id="cb412-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb412-3" data-line-number="3"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="st">"Age of plane (years)"</span>, <span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">30</span>, <span class="dt">by =</span> <span class="dv">10</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb412-4" data-line-number="4"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="st">"Mean Departure Delay (minutes)"</span>)</a></code></pre></div>
<p><img src="relational-data_files/figure-html/unnamed-chunk-26-1.png" width="70%" style="display: block; margin: auto;"></p>
<p>There is a similar relationship in arrival delays.
Delays increase with the age of the plane until ten years, then it declines and flattens out.</p>
<div class="sourceCode" id="cb413"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb413-1" data-line-number="1"><span class="kw">ggplot</span>(plane_cohorts, <span class="kw">aes</span>(<span class="dt">x =</span> age, <span class="dt">y =</span> arr_delay_mean)) <span class="op">+</span></a>
<a class="sourceLine" id="cb413-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb413-3" data-line-number="3"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="st">"Age of Plane (years)"</span>, <span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">30</span>, <span class="dt">by =</span> <span class="dv">10</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb413-4" data-line-number="4"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="st">"Mean Arrival Delay (minutes)"</span>)</a></code></pre></div>
<p><img src="relational-data_files/figure-html/unnamed-chunk-27-1.png" width="70%" style="display: block; margin: auto;"></p>
</div>
</div>
<div id="exercise-13.4.4" class="section level3 unnumbered exercise" data-number="13.4.4">
<h3>Exercise 13.4.4<a href="#exercise-13.4.4" class="anchor section-link" aria-hidden="true"><i class="fa fa-link" aria-hidden="true"></i></a>
</h3>
<div class="question">
<p>What weather conditions make it more likely to see a delay?</p>
</div>
<div class="answer">
<p>Almost any amount of precipitation is associated with a delay.
However, there is not a strong a trend above 0.02 in. of precipitation.</p>
<div class="sourceCode" id="cb414"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb414-1" data-line-number="1">flight_weather &lt;-</a>
<a class="sourceLine" id="cb414-2" data-line-number="2"><span class="st">  </span>flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb414-3" data-line-number="3"><span class="st">  </span><span class="kw">inner_join</span>(weather, <span class="dt">by =</span> <span class="kw">c</span>(</a>
<a class="sourceLine" id="cb414-4" data-line-number="4">    <span class="st">"origin"</span> =<span class="st"> "origin"</span>,</a>
<a class="sourceLine" id="cb414-5" data-line-number="5">    <span class="st">"year"</span> =<span class="st"> "year"</span>,</a>
<a class="sourceLine" id="cb414-6" data-line-number="6">    <span class="st">"month"</span> =<span class="st"> "month"</span>,</a>
<a class="sourceLine" id="cb414-7" data-line-number="7">    <span class="st">"day"</span> =<span class="st"> "day"</span>,</a>
<a class="sourceLine" id="cb414-8" data-line-number="8">    <span class="st">"hour"</span> =<span class="st"> "hour"</span></a>
<a class="sourceLine" id="cb414-9" data-line-number="9">  ))</a></code></pre></div>
<div class="sourceCode" id="cb415"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb415-1" data-line-number="1">flight_weather <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb415-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(precip) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb415-3" data-line-number="3"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">delay =</span> <span class="kw">mean</span>(dep_delay, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb415-4" data-line-number="4"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> precip, <span class="dt">y =</span> delay)) <span class="op">+</span></a>
<a class="sourceLine" id="cb415-5" data-line-number="5"><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>()</a>
<a class="sourceLine" id="cb415-6" data-line-number="6"><span class="co">#&gt; `summarise()` ungrouping output (override with `.groups` argument)</span></a></code></pre></div>
<p><img src="relational-data_files/figure-html/unnamed-chunk-29-1.png" width="70%" style="display: block; margin: auto;"></p>
<p>There seems to be a stronger relationship between visibility and delay.
Delays are higher when visibility is less than 2 miles.</p>
<div class="sourceCode" id="cb416"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb416-1" data-line-number="1">flight_weather <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb416-2" data-line-number="2"><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb416-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">visib_cat =</span> <span class="kw">cut_interval</span>(visib, <span class="dt">n =</span> <span class="dv">10</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb416-4" data-line-number="4"><span class="st">  </span><span class="kw">group_by</span>(visib_cat) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb416-5" data-line-number="5"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">dep_delay =</span> <span class="kw">mean</span>(dep_delay, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb416-6" data-line-number="6"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> visib_cat, <span class="dt">y =</span> dep_delay)) <span class="op">+</span></a>
<a class="sourceLine" id="cb416-7" data-line-number="7"><span class="st">  </span><span class="kw">geom_point</span>()</a>
<a class="sourceLine" id="cb416-8" data-line-number="8"><span class="co">#&gt; `summarise()` ungrouping output (override with `.groups` argument)</span></a></code></pre></div>
<p><img src="relational-data_files/figure-html/unnamed-chunk-30-1.png" width="70%" style="display: block; margin: auto;"></p>
</div>
</div>
<div id="exercise-13.4.5" class="section level3 unnumbered exercise" data-number="13.4.5">
<h3>Exercise 13.4.5<a href="#exercise-13.4.5" class="anchor section-link" aria-hidden="true"><i class="fa fa-link" aria-hidden="true"></i></a>
</h3>
<div class="question">
<p>What happened on June 13, 2013?
Display the spatial pattern of delays, and then use Google to cross-reference with the weather.</p>
</div>
<div class="answer">
<p>There was a large series of storms (derechos) in the southeastern US (see <a href="https://en.wikipedia.org/wiki/June_12%E2%80%9313,_2013_derecho_series">June 12-13, 2013 derecho series</a>).
The following plot show that the largest delays were in Tennessee (Nashville), the Southeast, and the Midwest, which were the locations of the derechos.</p>
<div class="sourceCode" id="cb417"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb417-1" data-line-number="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb417-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(year <span class="op">==</span><span class="st"> </span><span class="dv">2013</span>, month <span class="op">==</span><span class="st"> </span><span class="dv">6</span>, day <span class="op">==</span><span class="st"> </span><span class="dv">13</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb417-3" data-line-number="3"><span class="st">  </span><span class="kw">group_by</span>(dest) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb417-4" data-line-number="4"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">delay =</span> <span class="kw">mean</span>(arr_delay, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb417-5" data-line-number="5"><span class="st">  </span><span class="kw">inner_join</span>(airports, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">"dest"</span> =<span class="st"> "faa"</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb417-6" data-line-number="6"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">y =</span> lat, <span class="dt">x =</span> lon, <span class="dt">size =</span> delay, <span class="dt">colour =</span> delay)) <span class="op">+</span></a>
<a class="sourceLine" id="cb417-7" data-line-number="7"><span class="st">  </span><span class="kw">borders</span>(<span class="st">"state"</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb417-8" data-line-number="8"><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb417-9" data-line-number="9"><span class="st">  </span><span class="kw">coord_quickmap</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb417-10" data-line-number="10"><span class="st">  </span><span class="kw">scale_colour_viridis</span>()</a>
<a class="sourceLine" id="cb417-11" data-line-number="11"><span class="co">#&gt; `summarise()` ungrouping output (override with `.groups` argument)</span></a>
<a class="sourceLine" id="cb417-12" data-line-number="12"><span class="co">#&gt; Warning: Removed 3 rows containing missing values (geom_point).</span></a></code></pre></div>
<p><img src="relational-data_files/figure-html/unnamed-chunk-31-1.png" width="70%" style="display: block; margin: auto;"></p>
</div>
</div>
</div>
<div id="filtering-joins" class="section level2 r4ds-section">
<h2>
<a href="#filtering-joins" class="anchor section-link" aria-hidden="true"><i class="fa fa-link" aria-hidden="true"></i></a><span class="header-section-number">13.5</span> Filtering joins<a href="https://r4ds.had.co.nz/relational-data.html#filtering-joins" class="r4ds-section-link section-link" aria-hidden="true"><i class="fa fa-external-link" aria-hidden="true"></i></a>
</h2>
<div id="exercise-13.5.1" class="section level3 unnumbered exercise" data-number="13.5.1">
<h3>Exercise 13.5.1<a href="#exercise-13.5.1" class="anchor section-link" aria-hidden="true"><i class="fa fa-link" aria-hidden="true"></i></a>
</h3>
<div class="question">
<p>What does it mean for a flight to have a missing <code>tailnum</code>?
What do the tail numbers that don’t have a matching record in planes have in common?
(Hint: one variable explains ~90% of the problems.)</p>
</div>
<div class="answer">
<p>Flights that have a missing <code>tailnum</code> all have missing values of <code>arr_time</code>, meaning that the flight was canceled.</p>
<div class="sourceCode" id="cb418"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb418-1" data-line-number="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb418-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(<span class="kw">is.na</span>(tailnum), <span class="op">!</span><span class="kw">is.na</span>(arr_time)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb418-3" data-line-number="3"><span class="st">  </span><span class="kw">nrow</span>()</a>
<a class="sourceLine" id="cb418-4" data-line-number="4"><span class="co">#&gt; [1] 0</span></a></code></pre></div>
<p>Many of the tail numbers that don’t have a matching value in <code>planes</code> are
registered to American Airlines (AA) or Envoy Airlines (MQ).
The documentation for <code>planes</code> states</p>
<blockquote>
<p>American Airways (AA) and Envoy Air (MQ) report fleet numbers rather than tail numbers so can’t be matched.</p>
</blockquote>
<div class="sourceCode" id="cb419"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb419-1" data-line-number="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb419-2" data-line-number="2"><span class="st">  </span><span class="kw">anti_join</span>(planes, <span class="dt">by =</span> <span class="st">"tailnum"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb419-3" data-line-number="3"><span class="st">  </span><span class="kw">count</span>(carrier, <span class="dt">sort =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb419-4" data-line-number="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">p =</span> n <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(n))</a>
<a class="sourceLine" id="cb419-5" data-line-number="5"><span class="co">#&gt; # A tibble: 10 x 3</span></a>
<a class="sourceLine" id="cb419-6" data-line-number="6"><span class="co">#&gt;   carrier     n      p</span></a>
<a class="sourceLine" id="cb419-7" data-line-number="7"><span class="co">#&gt;   &lt;chr&gt;   &lt;int&gt;  &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb419-8" data-line-number="8"><span class="co">#&gt; 1 MQ      25397 0.483 </span></a>
<a class="sourceLine" id="cb419-9" data-line-number="9"><span class="co">#&gt; 2 AA      22558 0.429 </span></a>
<a class="sourceLine" id="cb419-10" data-line-number="10"><span class="co">#&gt; 3 UA       1693 0.0322</span></a>
<a class="sourceLine" id="cb419-11" data-line-number="11"><span class="co">#&gt; 4 9E       1044 0.0198</span></a>
<a class="sourceLine" id="cb419-12" data-line-number="12"><span class="co">#&gt; 5 B6        830 0.0158</span></a>
<a class="sourceLine" id="cb419-13" data-line-number="13"><span class="co">#&gt; 6 US        699 0.0133</span></a>
<a class="sourceLine" id="cb419-14" data-line-number="14"><span class="co">#&gt; # … with 4 more rows</span></a></code></pre></div>
<p>However, not all tail numbers appearing in<code>flights</code> from these carriers are missing from the <code>planes</code> table. I don’t know how to reconcile this discrepancy.</p>
<div class="sourceCode" id="cb420"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb420-1" data-line-number="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb420-2" data-line-number="2"><span class="st">  </span><span class="kw">distinct</span>(carrier, tailnum) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb420-3" data-line-number="3"><span class="st">  </span><span class="kw">left_join</span>(planes, <span class="dt">by =</span> <span class="st">"tailnum"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb420-4" data-line-number="4"><span class="st">  </span><span class="kw">group_by</span>(carrier) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb420-5" data-line-number="5"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">total_planes =</span> <span class="kw">n</span>(),</a>
<a class="sourceLine" id="cb420-6" data-line-number="6">            <span class="dt">not_in_planes =</span> <span class="kw">sum</span>(<span class="kw">is.na</span>(model))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb420-7" data-line-number="7"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">missing_pct =</span> not_in_planes <span class="op">/</span><span class="st"> </span>total_planes) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb420-8" data-line-number="8"><span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(missing_pct))</a>
<a class="sourceLine" id="cb420-9" data-line-number="9"><span class="co">#&gt; `summarise()` ungrouping output (override with `.groups` argument)</span></a>
<a class="sourceLine" id="cb420-10" data-line-number="10"><span class="co">#&gt; # A tibble: 16 x 4</span></a>
<a class="sourceLine" id="cb420-11" data-line-number="11"><span class="co">#&gt;   carrier total_planes not_in_planes missing_pct</span></a>
<a class="sourceLine" id="cb420-12" data-line-number="12"><span class="co">#&gt;   &lt;chr&gt;          &lt;int&gt;         &lt;int&gt;       &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb420-13" data-line-number="13"><span class="co">#&gt; 1 MQ               238           234      0.983 </span></a>
<a class="sourceLine" id="cb420-14" data-line-number="14"><span class="co">#&gt; 2 AA               601           430      0.715 </span></a>
<a class="sourceLine" id="cb420-15" data-line-number="15"><span class="co">#&gt; 3 F9                26             3      0.115 </span></a>
<a class="sourceLine" id="cb420-16" data-line-number="16"><span class="co">#&gt; 4 FL               129            12      0.0930</span></a>
<a class="sourceLine" id="cb420-17" data-line-number="17"><span class="co">#&gt; 5 UA               621            23      0.0370</span></a>
<a class="sourceLine" id="cb420-18" data-line-number="18"><span class="co">#&gt; 6 US               290             9      0.0310</span></a>
<a class="sourceLine" id="cb420-19" data-line-number="19"><span class="co">#&gt; # … with 10 more rows</span></a></code></pre></div>
</div>
</div>
<div id="exercise-13.5.2" class="section level3 unnumbered exercise" data-number="13.5.2">
<h3>Exercise 13.5.2<a href="#exercise-13.5.2" class="anchor section-link" aria-hidden="true"><i class="fa fa-link" aria-hidden="true"></i></a>
</h3>
<div class="question">
<p>Filter flights to only show flights with planes that have flown at least 100 flights.</p>
</div>
<div class="answer">
<p>First, I find all planes that have flown at least 100 flights.
I need to filter flights that are missing a tail number otherwise all flights missing a tail number will be treated as a single plane.</p>
<div class="sourceCode" id="cb421"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb421-1" data-line-number="1">planes_gte100 &lt;-<span class="st"> </span>flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb421-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(tailnum)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb421-3" data-line-number="3"><span class="st">  </span><span class="kw">group_by</span>(tailnum) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb421-4" data-line-number="4"><span class="st">  </span><span class="kw">count</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb421-5" data-line-number="5"><span class="st">  </span><span class="kw">filter</span>(n <span class="op">&gt;=</span><span class="st"> </span><span class="dv">100</span>)</a></code></pre></div>
<p>Now, I will semi join the data frame of planes that have flown at least 100 flights to the data frame of flights to select the flights by those planes.</p>
<div class="sourceCode" id="cb422"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb422-1" data-line-number="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb422-2" data-line-number="2"><span class="st">  </span><span class="kw">semi_join</span>(planes_gte100, <span class="dt">by =</span> <span class="st">"tailnum"</span>)</a>
<a class="sourceLine" id="cb422-3" data-line-number="3"><span class="co">#&gt; # A tibble: 228,390 x 19</span></a>
<a class="sourceLine" id="cb422-4" data-line-number="4"><span class="co">#&gt;    year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time</span></a>
<a class="sourceLine" id="cb422-5" data-line-number="5"><span class="co">#&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;</span></a>
<a class="sourceLine" id="cb422-6" data-line-number="6"><span class="co">#&gt; 1  2013     1     1      517            515         2      830            819</span></a>
<a class="sourceLine" id="cb422-7" data-line-number="7"><span class="co">#&gt; 2  2013     1     1      533            529         4      850            830</span></a>
<a class="sourceLine" id="cb422-8" data-line-number="8"><span class="co">#&gt; 3  2013     1     1      544            545        -1     1004           1022</span></a>
<a class="sourceLine" id="cb422-9" data-line-number="9"><span class="co">#&gt; 4  2013     1     1      554            558        -4      740            728</span></a>
<a class="sourceLine" id="cb422-10" data-line-number="10"><span class="co">#&gt; 5  2013     1     1      555            600        -5      913            854</span></a>
<a class="sourceLine" id="cb422-11" data-line-number="11"><span class="co">#&gt; 6  2013     1     1      557            600        -3      709            723</span></a>
<a class="sourceLine" id="cb422-12" data-line-number="12"><span class="co">#&gt; # … with 228,384 more rows, and 11 more variables: arr_delay &lt;dbl&gt;,</span></a>
<a class="sourceLine" id="cb422-13" data-line-number="13"><span class="co">#&gt; #   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;,</span></a>
<a class="sourceLine" id="cb422-14" data-line-number="14"><span class="co">#&gt; #   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</span></a></code></pre></div>
<p>This can also be answered with a grouped mutate.</p>
<div class="sourceCode" id="cb423"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb423-1" data-line-number="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb423-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(tailnum)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb423-3" data-line-number="3"><span class="st">  </span><span class="kw">group_by</span>(tailnum) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb423-4" data-line-number="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">n =</span> <span class="kw">n</span>()) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb423-5" data-line-number="5"><span class="st">  </span><span class="kw">filter</span>(n <span class="op">&gt;=</span><span class="st"> </span><span class="dv">100</span>)</a>
<a class="sourceLine" id="cb423-6" data-line-number="6"><span class="co">#&gt; # A tibble: 228,390 x 20</span></a>
<a class="sourceLine" id="cb423-7" data-line-number="7"><span class="co">#&gt; # Groups:   tailnum [1,217]</span></a>
<a class="sourceLine" id="cb423-8" data-line-number="8"><span class="co">#&gt;    year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time</span></a>
<a class="sourceLine" id="cb423-9" data-line-number="9"><span class="co">#&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;</span></a>
<a class="sourceLine" id="cb423-10" data-line-number="10"><span class="co">#&gt; 1  2013     1     1      517            515         2      830            819</span></a>
<a class="sourceLine" id="cb423-11" data-line-number="11"><span class="co">#&gt; 2  2013     1     1      533            529         4      850            830</span></a>
<a class="sourceLine" id="cb423-12" data-line-number="12"><span class="co">#&gt; 3  2013     1     1      544            545        -1     1004           1022</span></a>
<a class="sourceLine" id="cb423-13" data-line-number="13"><span class="co">#&gt; 4  2013     1     1      554            558        -4      740            728</span></a>
<a class="sourceLine" id="cb423-14" data-line-number="14"><span class="co">#&gt; 5  2013     1     1      555            600        -5      913            854</span></a>
<a class="sourceLine" id="cb423-15" data-line-number="15"><span class="co">#&gt; 6  2013     1     1      557            600        -3      709            723</span></a>
<a class="sourceLine" id="cb423-16" data-line-number="16"><span class="co">#&gt; # … with 228,384 more rows, and 12 more variables: arr_delay &lt;dbl&gt;,</span></a>
<a class="sourceLine" id="cb423-17" data-line-number="17"><span class="co">#&gt; #   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;,</span></a>
<a class="sourceLine" id="cb423-18" data-line-number="18"><span class="co">#&gt; #   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;,</span></a>
<a class="sourceLine" id="cb423-19" data-line-number="19"><span class="co">#&gt; #   n &lt;int&gt;</span></a></code></pre></div>
</div>
</div>
<div id="exercise-13.5.3" class="section level3 unnumbered exercise" data-number="13.5.3">
<h3>Exercise 13.5.3<a href="#exercise-13.5.3" class="anchor section-link" aria-hidden="true"><i class="fa fa-link" aria-hidden="true"></i></a>
</h3>
<div class="question">
<p>Combine <code>fueleconomy::vehicles</code> and <code>fueleconomy::common</code> to find only the records for the most common models.</p>
</div>
<div class="answer">
<div class="sourceCode" id="cb424"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb424-1" data-line-number="1">fueleconomy<span class="op">::</span>vehicles <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb424-2" data-line-number="2"><span class="st">  </span><span class="kw">semi_join</span>(fueleconomy<span class="op">::</span>common, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">"make"</span>, <span class="st">"model"</span>))</a>
<a class="sourceLine" id="cb424-3" data-line-number="3"><span class="co">#&gt; # A tibble: 14,531 x 12</span></a>
<a class="sourceLine" id="cb424-4" data-line-number="4"><span class="co">#&gt;      id make  model   year class   trans   drive     cyl displ fuel    hwy   cty</span></a>
<a class="sourceLine" id="cb424-5" data-line-number="5"><span class="co">#&gt;   &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;  &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb424-6" data-line-number="6"><span class="co">#&gt; 1  1833 Acura Integ…  1986 Subcom… Automa… Front-…     4   1.6 Regu…    28    22</span></a>
<a class="sourceLine" id="cb424-7" data-line-number="7"><span class="co">#&gt; 2  1834 Acura Integ…  1986 Subcom… Manual… Front-…     4   1.6 Regu…    28    23</span></a>
<a class="sourceLine" id="cb424-8" data-line-number="8"><span class="co">#&gt; 3  3037 Acura Integ…  1987 Subcom… Automa… Front-…     4   1.6 Regu…    28    22</span></a>
<a class="sourceLine" id="cb424-9" data-line-number="9"><span class="co">#&gt; 4  3038 Acura Integ…  1987 Subcom… Manual… Front-…     4   1.6 Regu…    28    23</span></a>
<a class="sourceLine" id="cb424-10" data-line-number="10"><span class="co">#&gt; 5  4183 Acura Integ…  1988 Subcom… Automa… Front-…     4   1.6 Regu…    27    22</span></a>
<a class="sourceLine" id="cb424-11" data-line-number="11"><span class="co">#&gt; 6  4184 Acura Integ…  1988 Subcom… Manual… Front-…     4   1.6 Regu…    28    23</span></a>
<a class="sourceLine" id="cb424-12" data-line-number="12"><span class="co">#&gt; # … with 14,525 more rows</span></a></code></pre></div>
<p>Why does the above code join on <code>make</code> and <code>model</code> and not just <code>model</code>?
It is possible for two car brands (<code>make</code>) to produce a car with the same name (<code>model</code>).
In both the <code>vehicles</code> and <code>common</code> data we can find some examples.
For example, “Truck 4WD” is produced by many different brands.</p>
<div class="sourceCode" id="cb425"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb425-1" data-line-number="1">fueleconomy<span class="op">::</span>vehicles <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb425-2" data-line-number="2"><span class="st">  </span><span class="kw">distinct</span>(model, make) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb425-3" data-line-number="3"><span class="st">  </span><span class="kw">group_by</span>(model) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb425-4" data-line-number="4"><span class="st">  </span><span class="kw">filter</span>(<span class="kw">n</span>() <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb425-5" data-line-number="5"><span class="st">  </span><span class="kw">arrange</span>(model)</a>
<a class="sourceLine" id="cb425-6" data-line-number="6"><span class="co">#&gt; # A tibble: 126 x 2</span></a>
<a class="sourceLine" id="cb425-7" data-line-number="7"><span class="co">#&gt; # Groups:   model [60]</span></a>
<a class="sourceLine" id="cb425-8" data-line-number="8"><span class="co">#&gt;   make                   model              </span></a>
<a class="sourceLine" id="cb425-9" data-line-number="9"><span class="co">#&gt;   &lt;chr&gt;                  &lt;chr&gt;              </span></a>
<a class="sourceLine" id="cb425-10" data-line-number="10"><span class="co">#&gt; 1 Audi                   200                </span></a>
<a class="sourceLine" id="cb425-11" data-line-number="11"><span class="co">#&gt; 2 Chrysler               200                </span></a>
<a class="sourceLine" id="cb425-12" data-line-number="12"><span class="co">#&gt; 3 Mcevoy Motors          240 DL/240 GL Wagon</span></a>
<a class="sourceLine" id="cb425-13" data-line-number="13"><span class="co">#&gt; 4 Volvo                  240 DL/240 GL Wagon</span></a>
<a class="sourceLine" id="cb425-14" data-line-number="14"><span class="co">#&gt; 5 Lambda Control Systems 300E               </span></a>
<a class="sourceLine" id="cb425-15" data-line-number="15"><span class="co">#&gt; 6 Mercedes-Benz          300E               </span></a>
<a class="sourceLine" id="cb425-16" data-line-number="16"><span class="co">#&gt; # … with 120 more rows</span></a></code></pre></div>
<div class="sourceCode" id="cb426"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb426-1" data-line-number="1">fueleconomy<span class="op">::</span>common <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb426-2" data-line-number="2"><span class="st">  </span><span class="kw">distinct</span>(model, make) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb426-3" data-line-number="3"><span class="st">  </span><span class="kw">group_by</span>(model) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb426-4" data-line-number="4"><span class="st">  </span><span class="kw">filter</span>(<span class="kw">n</span>() <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb426-5" data-line-number="5"><span class="st">  </span><span class="kw">arrange</span>(model)</a>
<a class="sourceLine" id="cb426-6" data-line-number="6"><span class="co">#&gt; # A tibble: 8 x 2</span></a>
<a class="sourceLine" id="cb426-7" data-line-number="7"><span class="co">#&gt; # Groups:   model [3]</span></a>
<a class="sourceLine" id="cb426-8" data-line-number="8"><span class="co">#&gt;   make       model    </span></a>
<a class="sourceLine" id="cb426-9" data-line-number="9"><span class="co">#&gt;   &lt;chr&gt;      &lt;chr&gt;    </span></a>
<a class="sourceLine" id="cb426-10" data-line-number="10"><span class="co">#&gt; 1 Dodge      Colt     </span></a>
<a class="sourceLine" id="cb426-11" data-line-number="11"><span class="co">#&gt; 2 Plymouth   Colt     </span></a>
<a class="sourceLine" id="cb426-12" data-line-number="12"><span class="co">#&gt; 3 Mitsubishi Truck 2WD</span></a>
<a class="sourceLine" id="cb426-13" data-line-number="13"><span class="co">#&gt; 4 Nissan     Truck 2WD</span></a>
<a class="sourceLine" id="cb426-14" data-line-number="14"><span class="co">#&gt; 5 Toyota     Truck 2WD</span></a>
<a class="sourceLine" id="cb426-15" data-line-number="15"><span class="co">#&gt; 6 Mitsubishi Truck 4WD</span></a>
<a class="sourceLine" id="cb426-16" data-line-number="16"><span class="co">#&gt; # … with 2 more rows</span></a></code></pre></div>
<p>If we were to merge these data on the <code>model</code> column alone, there would be incorrect matches.</p>
</div>
</div>
<div id="exercise-13.5.4" class="section level3 unnumbered exercise" data-number="13.5.4">
<h3>Exercise 13.5.4<a href="#exercise-13.5.4" class="anchor section-link" aria-hidden="true"><i class="fa fa-link" aria-hidden="true"></i></a>
</h3>
<div class="question">
<p>Find the 48 hours (over the course of the whole year) that have the worst delays.
Cross-reference it with the weather data.
Can you see any patterns?</p>
</div>
<div class="answer">
<p>I will start by clarifying how I will be measuring the concepts in the question.
There are three concepts that need to be defined more precisely.</p>
<ol style="list-style-type: decimal">
<li><p>What is meant by “delay”?
I will use departure delay.
Since the <code>weather</code> data only contains data for the New York City airports, and
departure delays will be more sensitive to New York City weather conditions than arrival delays.</p></li>
<li><p>What is meant by “worst”? I define worst delay as the average departure delay per flight for flights <em>scheduled</em> to depart in that hour.
For hour, I will use the scheduled departure time rather than the actual departure time.
If planes are delayed due to weather conditions, the weather conditions during the scheduled time are more important than the actual departure time, at which point, the weather could have improved.</p></li>
<li><p>What is meant by “48 hours over the course of the year”? This could mean two days, a span of 48 contiguous hours,
or 48 hours that are not necessarily contiguous hours.
I will find 48 not-necessarily contiguous hours.
That definition makes better use of the methods introduced in this section and chapter.</p></li>
<li><p>What is the unit of analysis? Although the question mentions only hours, I will use airport hours.
The weather dataset has an observation for each airport for each hour.
Since all the departure airports are in the vicinity of New York City, their weather should be similar, it will not be the same.</p></li>
</ol>
<p>First, I need to find the 48 hours with the worst delays.
I group flights by hour of scheduled departure time and calculate the average delay.
Then I select the 48 observations (hours) with the highest average delay.</p>
<div class="sourceCode" id="cb427"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb427-1" data-line-number="1">worst_hours &lt;-<span class="st"> </span>flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb427-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">hour =</span> sched_dep_time <span class="op">%/%</span><span class="st"> </span><span class="dv">100</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb427-3" data-line-number="3"><span class="st">  </span><span class="kw">group_by</span>(origin, year, month, day, hour) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb427-4" data-line-number="4"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">dep_delay =</span> <span class="kw">mean</span>(dep_delay, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb427-5" data-line-number="5"><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb427-6" data-line-number="6"><span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(dep_delay)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb427-7" data-line-number="7"><span class="st">  </span><span class="kw">slice</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">48</span>)</a>
<a class="sourceLine" id="cb427-8" data-line-number="8"><span class="co">#&gt; `summarise()` regrouping output by 'origin', 'year', 'month', 'day' (override with `.groups` argument)</span></a></code></pre></div>
<p>Then I can use <code>semi_join()</code> to get the weather for these hours.</p>
<div class="sourceCode" id="cb428"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb428-1" data-line-number="1">weather_most_delayed &lt;-<span class="st"> </span><span class="kw">semi_join</span>(weather, worst_hours, </a>
<a class="sourceLine" id="cb428-2" data-line-number="2">                                  <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">"origin"</span>, <span class="st">"year"</span>,</a>
<a class="sourceLine" id="cb428-3" data-line-number="3">                                         <span class="st">"month"</span>, <span class="st">"day"</span>, <span class="st">"hour"</span>))</a></code></pre></div>
<p>For weather, I’ll focus on precipitation, wind speed, and temperature.
I will display these in both a table and a plot.<br>
Many of these observations have a higher than average wind speed (10 mph) or some precipitation.
However, I would have expected the weather for the hours with the worst delays to be much worse.</p>
<div class="sourceCode" id="cb429"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb429-1" data-line-number="1"><span class="kw">select</span>(weather_most_delayed, temp, wind_speed, precip) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb429-2" data-line-number="2"><span class="st">  </span><span class="kw">print</span>(<span class="dt">n =</span> <span class="dv">48</span>)</a>
<a class="sourceLine" id="cb429-3" data-line-number="3"><span class="co">#&gt; # A tibble: 48 x 3</span></a>
<a class="sourceLine" id="cb429-4" data-line-number="4"><span class="co">#&gt;     temp wind_speed precip</span></a>
<a class="sourceLine" id="cb429-5" data-line-number="5"><span class="co">#&gt;    &lt;dbl&gt;      &lt;dbl&gt;  &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb429-6" data-line-number="6"><span class="co">#&gt;  1  27.0      13.8    0   </span></a>
<a class="sourceLine" id="cb429-7" data-line-number="7"><span class="co">#&gt;  2  28.0      19.6    0   </span></a>
<a class="sourceLine" id="cb429-8" data-line-number="8"><span class="co">#&gt;  3  28.9      28.8    0   </span></a>
<a class="sourceLine" id="cb429-9" data-line-number="9"><span class="co">#&gt;  4  33.8       9.21   0.06</span></a>
<a class="sourceLine" id="cb429-10" data-line-number="10"><span class="co">#&gt;  5  34.0       8.06   0.05</span></a>
<a class="sourceLine" id="cb429-11" data-line-number="11"><span class="co">#&gt;  6  80.1       8.06   0   </span></a>
<a class="sourceLine" id="cb429-12" data-line-number="12"><span class="co">#&gt;  7  86        13.8    0   </span></a>
<a class="sourceLine" id="cb429-13" data-line-number="13"><span class="co">#&gt;  8  73.4       6.90   0.08</span></a>
<a class="sourceLine" id="cb429-14" data-line-number="14"><span class="co">#&gt;  9  84.0       5.75   0   </span></a>
<a class="sourceLine" id="cb429-15" data-line-number="15"><span class="co">#&gt; 10  78.8      18.4    0.23</span></a>
<a class="sourceLine" id="cb429-16" data-line-number="16"><span class="co">#&gt; 11  53.6       0      0   </span></a>
<a class="sourceLine" id="cb429-17" data-line-number="17"><span class="co">#&gt; 12  60.8      31.1    0.11</span></a>
<a class="sourceLine" id="cb429-18" data-line-number="18"><span class="co">#&gt; 13  55.4      17.3    0.14</span></a>
<a class="sourceLine" id="cb429-19" data-line-number="19"><span class="co">#&gt; 14  53.1       9.21   0.01</span></a>
<a class="sourceLine" id="cb429-20" data-line-number="20"><span class="co">#&gt; 15  55.9      11.5    0.1 </span></a>
<a class="sourceLine" id="cb429-21" data-line-number="21"><span class="co">#&gt; 16  55.4       8.06   0.15</span></a>
<a class="sourceLine" id="cb429-22" data-line-number="22"><span class="co">#&gt; 17  57.0      29.9    0   </span></a>
<a class="sourceLine" id="cb429-23" data-line-number="23"><span class="co">#&gt; 18  33.8      20.7    0.02</span></a>
<a class="sourceLine" id="cb429-24" data-line-number="24"><span class="co">#&gt; 19  34.0      19.6    0.01</span></a>
<a class="sourceLine" id="cb429-25" data-line-number="25"><span class="co">#&gt; 20  36.0      21.9    0.01</span></a>
<a class="sourceLine" id="cb429-26" data-line-number="26"><span class="co">#&gt; 21  37.9      16.1    0   </span></a>
<a class="sourceLine" id="cb429-27" data-line-number="27"><span class="co">#&gt; 22  32        13.8    0.12</span></a>
<a class="sourceLine" id="cb429-28" data-line-number="28"><span class="co">#&gt; 23  60.1      33.4    0.14</span></a>
<a class="sourceLine" id="cb429-29" data-line-number="29"><span class="co">#&gt; 24  60.8      11.5    0.02</span></a>
<a class="sourceLine" id="cb429-30" data-line-number="30"><span class="co">#&gt; 25  62.1      17.3    0   </span></a>
<a class="sourceLine" id="cb429-31" data-line-number="31"><span class="co">#&gt; 26  66.9      10.4    0   </span></a>
<a class="sourceLine" id="cb429-32" data-line-number="32"><span class="co">#&gt; 27  66.9      13.8    0   </span></a>
<a class="sourceLine" id="cb429-33" data-line-number="33"><span class="co">#&gt; 28  79.0      10.4    0   </span></a>
<a class="sourceLine" id="cb429-34" data-line-number="34"><span class="co">#&gt; 29  77        16.1    0.07</span></a>
<a class="sourceLine" id="cb429-35" data-line-number="35"><span class="co">#&gt; 30  75.9      13.8    0   </span></a>
<a class="sourceLine" id="cb429-36" data-line-number="36"><span class="co">#&gt; 31  82.4       8.06   0   </span></a>
<a class="sourceLine" id="cb429-37" data-line-number="37"><span class="co">#&gt; 32  86         9.21   0   </span></a>
<a class="sourceLine" id="cb429-38" data-line-number="38"><span class="co">#&gt; 33  80.1       9.21   0   </span></a>
<a class="sourceLine" id="cb429-39" data-line-number="39"><span class="co">#&gt; 34  80.6      11.5    0   </span></a>
<a class="sourceLine" id="cb429-40" data-line-number="40"><span class="co">#&gt; 35  78.1       6.90   0   </span></a>
<a class="sourceLine" id="cb429-41" data-line-number="41"><span class="co">#&gt; 36  75.2      10.4    0.01</span></a>
<a class="sourceLine" id="cb429-42" data-line-number="42"><span class="co">#&gt; 37  73.9       5.75   0.03</span></a>
<a class="sourceLine" id="cb429-43" data-line-number="43"><span class="co">#&gt; 38  73.9       8.06   0   </span></a>
<a class="sourceLine" id="cb429-44" data-line-number="44"><span class="co">#&gt; 39  75.0       4.60   0   </span></a>
<a class="sourceLine" id="cb429-45" data-line-number="45"><span class="co">#&gt; 40  75.0       4.60   0.01</span></a>
<a class="sourceLine" id="cb429-46" data-line-number="46"><span class="co">#&gt; 41  80.1       0      0.01</span></a>
<a class="sourceLine" id="cb429-47" data-line-number="47"><span class="co">#&gt; 42  80.1       0      0   </span></a>
<a class="sourceLine" id="cb429-48" data-line-number="48"><span class="co">#&gt; 43  77        10.4    0   </span></a>
<a class="sourceLine" id="cb429-49" data-line-number="49"><span class="co">#&gt; 44  82.0      10.4    0   </span></a>
<a class="sourceLine" id="cb429-50" data-line-number="50"><span class="co">#&gt; 45  72.0      13.8    0.3 </span></a>
<a class="sourceLine" id="cb429-51" data-line-number="51"><span class="co">#&gt; 46  72.0       4.60   0.03</span></a>
<a class="sourceLine" id="cb429-52" data-line-number="52"><span class="co">#&gt; 47  51.1       4.60   0   </span></a>
<a class="sourceLine" id="cb429-53" data-line-number="53"><span class="co">#&gt; 48  54.0       6.90   0</span></a></code></pre></div>
<div class="sourceCode" id="cb430"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb430-1" data-line-number="1"><span class="kw">ggplot</span>(weather_most_delayed, <span class="kw">aes</span>(<span class="dt">x =</span> precip, <span class="dt">y =</span> wind_speed, <span class="dt">color =</span> temp)) <span class="op">+</span></a>
<a class="sourceLine" id="cb430-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_point</span>()</a></code></pre></div>
<p><img src="relational-data_files/figure-html/unnamed-chunk-44-1.png" width="70%" style="display: block; margin: auto;"></p>
<p>It’s hard to say much more than that without using the tools from <a href="https://r4ds.had.co.nz/exploratory-data-analysis.html#covariation">Exploratory Data Analysis</a> section
to look for covariation between weather and flight delays using all flights.
Implicitly in my informal analysis of trends in weather using only the 48 hours with the worst delays, I was comparing the weather in these hours to some belief I had about what constitutes “normal” or “good” weather.
It would be better to actually use data to make that comparison.</p>
</div>
</div>
<div id="exercise-13.5.5" class="section level3 unnumbered exercise" data-number="13.5.5">
<h3>Exercise 13.5.5<a href="#exercise-13.5.5" class="anchor section-link" aria-hidden="true"><i class="fa fa-link" aria-hidden="true"></i></a>
</h3>
<div class="question">
<p>What does <code>anti_join(flights, airports, by = c("dest" = "faa"))</code> tell you?
What does <code>anti_join(airports, flights, by = c("faa" = "dest"))</code> tell you?</p>
</div>
<div class="answer">
<p>The expression <code>anti_join(flights, airports, by = c("dest" = "faa"))</code> returns the flights that went to an airport that is not in the FAA list of destinations.
Since the FAA list only contains domestic airports, these are likely foreign flights.
However, running that expression that there are only four airports in this list.</p>
<div class="sourceCode" id="cb431"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb431-1" data-line-number="1"><span class="kw">anti_join</span>(flights, airports, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">"dest"</span> =<span class="st"> "faa"</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb431-2" data-line-number="2"><span class="st">  </span><span class="kw">distinct</span>(dest)</a>
<a class="sourceLine" id="cb431-3" data-line-number="3"><span class="co">#&gt; # A tibble: 4 x 1</span></a>
<a class="sourceLine" id="cb431-4" data-line-number="4"><span class="co">#&gt;   dest </span></a>
<a class="sourceLine" id="cb431-5" data-line-number="5"><span class="co">#&gt;   &lt;chr&gt;</span></a>
<a class="sourceLine" id="cb431-6" data-line-number="6"><span class="co">#&gt; 1 BQN  </span></a>
<a class="sourceLine" id="cb431-7" data-line-number="7"><span class="co">#&gt; 2 SJU  </span></a>
<a class="sourceLine" id="cb431-8" data-line-number="8"><span class="co">#&gt; 3 STT  </span></a>
<a class="sourceLine" id="cb431-9" data-line-number="9"><span class="co">#&gt; 4 PSE</span></a></code></pre></div>
<p>In this set of four airports three are in Puerto Rico (<a href="https://en.wikipedia.org/wiki/Rafael_Hern%C3%A1ndez_Airport">BQN</a>, <a href="https://en.wikipedia.org/wiki/Luis_Mu%C3%B1oz_Mar%C3%ADn_International_Airport">SJU</a>, and <a href="https://en.wikipedia.org/wiki/Mercedita_International_Airport">PSE</a>) and one is in the US Virgin Islands ( <a href="https://en.wikipedia.org/wiki/Cyril_E._King_Airport">STT</a>).</p>
<p>The reason for this discrepancy is that the <code>flights</code> and <code>airports</code> tables are derived from different sources.
The <code>flights</code> data comes from the US Department of Transportation <a href="https://www.transtats.bts.gov/DL_SelectFields.asp?Table_ID=236">Bureau of Transportation Statistics</a>, while the airport metadata comes from <a href="https://openflights.org/data.html">openflights.org</a>.
The BTS includes Puerto Rico and U.S. Virgin Islands as “domestic” (part of the US), while the <a href="https://raw.githubusercontent.com/jpatokal/openflights/master/data/airports.dat">openflights.org</a> give use different values of country for airports in the US states (<code>"United States"</code>) Puerto Rico (<code>"Puerto Rico"</code>) and US Virgin Islands (<code>"Virgin Islands"</code>).</p>
<p>The expression <code>anti_join(airports, flights, by = c("faa" = "dest"))</code> returns the US airports that were not the destination of any flight in the data.
Since the data contains all flights from New York City airports, this is also the list of US airports that did not have a nonstop flight from New York City in 2013.</p>
<div class="sourceCode" id="cb432"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb432-1" data-line-number="1"><span class="kw">anti_join</span>(airports, flights, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">"faa"</span> =<span class="st"> "dest"</span>))</a>
<a class="sourceLine" id="cb432-2" data-line-number="2"><span class="co">#&gt; # A tibble: 1,357 x 8</span></a>
<a class="sourceLine" id="cb432-3" data-line-number="3"><span class="co">#&gt;   faa   name                          lat   lon   alt    tz dst   tzone         </span></a>
<a class="sourceLine" id="cb432-4" data-line-number="4"><span class="co">#&gt;   &lt;chr&gt; &lt;chr&gt;                       &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;         </span></a>
<a class="sourceLine" id="cb432-5" data-line-number="5"><span class="co">#&gt; 1 04G   Lansdowne Airport            41.1 -80.6  1044    -5 A     America/New_Y…</span></a>
<a class="sourceLine" id="cb432-6" data-line-number="6"><span class="co">#&gt; 2 06A   Moton Field Municipal Airp…  32.5 -85.7   264    -6 A     America/Chica…</span></a>
<a class="sourceLine" id="cb432-7" data-line-number="7"><span class="co">#&gt; 3 06C   Schaumburg Regional          42.0 -88.1   801    -6 A     America/Chica…</span></a>
<a class="sourceLine" id="cb432-8" data-line-number="8"><span class="co">#&gt; 4 06N   Randall Airport              41.4 -74.4   523    -5 A     America/New_Y…</span></a>
<a class="sourceLine" id="cb432-9" data-line-number="9"><span class="co">#&gt; 5 09J   Jekyll Island Airport        31.1 -81.4    11    -5 A     America/New_Y…</span></a>
<a class="sourceLine" id="cb432-10" data-line-number="10"><span class="co">#&gt; 6 0A9   Elizabethton Municipal Air…  36.4 -82.2  1593    -5 A     America/New_Y…</span></a>
<a class="sourceLine" id="cb432-11" data-line-number="11"><span class="co">#&gt; # … with 1,351 more rows</span></a></code></pre></div>
</div>
</div>
<div id="exercise-13.5.6" class="section level3 unnumbered exercise" data-number="13.5.6">
<h3>Exercise 13.5.6<a href="#exercise-13.5.6" class="anchor section-link" aria-hidden="true"><i class="fa fa-link" aria-hidden="true"></i></a>
</h3>
<div class="question">
<p>You might expect that there’s an implicit relationship between plane and airline, because each plane is flown by a single airline.
Confirm or reject this hypothesis using the tools you’ve learned above.</p>
</div>
<div class="answer">
<p>At each point in time, each plane is flown by a single airline.
However, a plane can be sold and fly for multiple airlines.
Logically, it is possible that a plane can fly for multiple airlines over the course of its lifetime.
But, it is not necessarily the case that a plane will fly for more than one airline in this data, especially since it comprises only a year of data.
So let’s check to see if there are any planes in the data flew for multiple airlines.</p>
<p>First, find all distinct airline, plane combinations.</p>
<div class="sourceCode" id="cb433"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb433-1" data-line-number="1">planes_carriers &lt;-</a>
<a class="sourceLine" id="cb433-2" data-line-number="2"><span class="st">  </span>flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb433-3" data-line-number="3"><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(tailnum)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb433-4" data-line-number="4"><span class="st">  </span><span class="kw">distinct</span>(tailnum, carrier)</a></code></pre></div>
<p>The number of planes that have flown for more than one airline are those <code>tailnum</code> that appear more than once in the <code>planes_carriers</code> data.</p>
<div class="sourceCode" id="cb434"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb434-1" data-line-number="1">planes_carriers <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb434-2" data-line-number="2"><span class="st">  </span><span class="kw">count</span>(tailnum) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb434-3" data-line-number="3"><span class="st">  </span><span class="kw">filter</span>(n <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb434-4" data-line-number="4"><span class="st">  </span><span class="kw">nrow</span>()</a>
<a class="sourceLine" id="cb434-5" data-line-number="5"><span class="co">#&gt; [1] 17</span></a></code></pre></div>
<p>The names of airlines are easier to understand than the two-letter carrier codes.
The <code>airlines</code> data frame contains the names of the airlines.</p>
<div class="sourceCode" id="cb435"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb435-1" data-line-number="1">carrier_transfer_tbl &lt;-<span class="st"> </span>planes_carriers <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb435-2" data-line-number="2"><span class="st">  </span><span class="co"># keep only planes which have flown for more than one airline</span></a>
<a class="sourceLine" id="cb435-3" data-line-number="3"><span class="st">  </span><span class="kw">group_by</span>(tailnum) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb435-4" data-line-number="4"><span class="st">  </span><span class="kw">filter</span>(<span class="kw">n</span>() <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb435-5" data-line-number="5"><span class="st">  </span><span class="co"># join with airlines to get airline names</span></a>
<a class="sourceLine" id="cb435-6" data-line-number="6"><span class="st">  </span><span class="kw">left_join</span>(airlines, <span class="dt">by =</span> <span class="st">"carrier"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb435-7" data-line-number="7"><span class="st">  </span><span class="kw">arrange</span>(tailnum, carrier)</a>
<a class="sourceLine" id="cb435-8" data-line-number="8"></a>
<a class="sourceLine" id="cb435-9" data-line-number="9">carrier_transfer_tbl</a>
<a class="sourceLine" id="cb435-10" data-line-number="10"><span class="co">#&gt; # A tibble: 34 x 3</span></a>
<a class="sourceLine" id="cb435-11" data-line-number="11"><span class="co">#&gt; # Groups:   tailnum [17]</span></a>
<a class="sourceLine" id="cb435-12" data-line-number="12"><span class="co">#&gt;   carrier tailnum name                    </span></a>
<a class="sourceLine" id="cb435-13" data-line-number="13"><span class="co">#&gt;   &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;                   </span></a>
<a class="sourceLine" id="cb435-14" data-line-number="14"><span class="co">#&gt; 1 9E      N146PQ  Endeavor Air Inc.       </span></a>
<a class="sourceLine" id="cb435-15" data-line-number="15"><span class="co">#&gt; 2 EV      N146PQ  ExpressJet Airlines Inc.</span></a>
<a class="sourceLine" id="cb435-16" data-line-number="16"><span class="co">#&gt; 3 9E      N153PQ  Endeavor Air Inc.       </span></a>
<a class="sourceLine" id="cb435-17" data-line-number="17"><span class="co">#&gt; 4 EV      N153PQ  ExpressJet Airlines Inc.</span></a>
<a class="sourceLine" id="cb435-18" data-line-number="18"><span class="co">#&gt; 5 9E      N176PQ  Endeavor Air Inc.       </span></a>
<a class="sourceLine" id="cb435-19" data-line-number="19"><span class="co">#&gt; 6 EV      N176PQ  ExpressJet Airlines Inc.</span></a>
<a class="sourceLine" id="cb435-20" data-line-number="20"><span class="co">#&gt; # … with 28 more rows</span></a></code></pre></div>
</div>
</div>
</div>
<div id="join-problems" class="section level2 r4ds-section">
<h2>
<a href="#join-problems" class="anchor section-link" aria-hidden="true"><i class="fa fa-link" aria-hidden="true"></i></a><span class="header-section-number">13.6</span> Join problems<a href="https://r4ds.had.co.nz/relational-data.html#join-problems" class="r4ds-section-link section-link" aria-hidden="true"><i class="fa fa-external-link" aria-hidden="true"></i></a>
</h2>
<div class="alert alert-warning hints-alert">
<div class="hints-icon">
<i class="fa fa-exclamation-circle"></i>
</div>
<div class="hints-container">No exercises</div>
</div>
</div>
<div id="set-operations" class="section level2 r4ds-section">
<h2>
<a href="#set-operations" class="anchor section-link" aria-hidden="true"><i class="fa fa-link" aria-hidden="true"></i></a><span class="header-section-number">13.7</span> Set operations<a href="https://r4ds.had.co.nz/relational-data.html#set-operations" class="r4ds-section-link section-link" aria-hidden="true"><i class="fa fa-external-link" aria-hidden="true"></i></a>
</h2>
<div class="alert alert-warning hints-alert">
<div class="hints-icon">
<i class="fa fa-exclamation-circle"></i>
</div>
<div class="hints-container">No exercises</div>
</div>

</div>
</div>
            </section>
</div>
        </div>
      </div>
<a href="tidy-data.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="strings.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script><script src="libs/gitbook-2.6.7/js/lunr.js"></script><script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script><script src="libs/gitbook-2.6.7/js/plugin-search.js"></script><script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script><script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script><script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script><script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script><script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script><script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": false,
"twitter": true,
"linkedin": true,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"],
"google": false
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/jrnold/r4ds-exercise-solutions/edit/master/relational-data.Rmd",
"text": "Edit"
},
"history": {
"link": "https://github.com/jrnold/r4ds-exercise-solutions/commits/master/relational-data.Rmd",
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section"
}
});
});
</script><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>
</html>
